had_disaster_trigger = {
	custom_description = {
		text = had_disaster_trigger_text
		has_variable = had_$type$_disaster
		value = disaster_type:$type$
	}
}

ambrosian_republic_disaster_end_trigger = {
	OR = {
		AND = {
			stability > 20
			estate_satisfaction:nobles_estate > 0.5
			estate_satisfaction:clergy_estate > 0.5
			estate_satisfaction:burghers_estate > 0.5
			estate_satisfaction:peasants_estate > 0.5
		}
		custom_tooltip = {
			has_variable = chose_ally_union
			text = has_chosen_ally_union_variable_tt
		}
		government_type = government_type:monarchy
	}
}

ciompi_revolt_end_trigger = {
	OR = { 
		has_reform = government_reform:peasant_republic_reform
		AND = {
			stability > 40
			"estate(estate_type:burghers_estate)" = { estate_tax_rate >= 0.3 }
			"estate(estate_type:peasants_estate)" = { estate_tax_rate >= 0.3 }
			in_civil_war = no
		}
	}
}

crisis_of_the_sayfawa_dynasty_end_trigger = {
	at_war = no 
	has_ruler = yes
	stability >= 40
	government_power >= 90
	NOT = {
		any_rebel = { rebel_progress >= 0.25 }
	}
}

curse_of_stefan_uros_iii_end_trigger = {
	OR = {
		NOT = { country_rank = country_rank:rank_empire }
		ruler ?= { total_abilities >= 250 }
		stability >= 30
		government_power >= 75
	}
}

dissolution_of_delhi_end_trigger = {
	stability >= 75
	government_power >= 75
}

hook_and_cod_wars_end_trigger = {
	OR = {
		NOT = { has_enabled_disaster_trigger = { type = hook_and_cod_wars } }
		custom_tooltip = {
			text = hook_and_cod_wars_hooks_have_won_tt
			has_variable = hacw_hook_faction_power
			var:hacw_hook_faction_power >= 20
		}
		custom_tooltip = {
			text = hook_and_cod_wars_cods_have_won_tt
			has_variable = hacw_cod_faction_power
			var:hacw_cod_faction_power >= 20
		}
		hidden_trigger = {
			#Special case, both claimants are one and the same
			has_variable = hacw_hook_contender
			has_variable = hacw_cod_contender
			var:hacw_hook_contender = var:hacw_cod_contender
		}
	}
}

muscovite_succession_war_end_trigger = {
	NOT = {
		any_rebel = {
			rebel_name_key = war_of_succession_pretender
			any_character_supporting_rebel = {
				is_alive = yes
				is_adult = yes
				is_female = no
			}
		}
	}
	num_rebels = 0
	has_regent = no
}

peasants_war_end_trigger = {
	stability > 10
	in_civil_war = no
	OR = {
		societal_value:serfdom_vs_free_subjects < {
			value = {
				add = var:peasants_war_target_ending_variable
				subtract = 25
				min = -95
				max = 0
			}
		}
		AND = {
			societal_value:serfdom_vs_free_subjects > {
				value = {
					add = var:peasants_war_target_ending_variable
					add = 25
					min = 0
					max = 95
				}
			}
		}
		AND = {
			estate_satisfaction:peasants_estate > 0.6
			war_exhaustion_percentage < 0.1 
		}
		in_civil_war = yes
		NOT = { country_has_estate = estate_type:peasants_estate }
	}
}

reform_society_end_trigger = {
	societal_value:centralization_vs_decentralization < -80
	had_disaster_for_years = {
		disaster_type = scope:disaster
		years >= 10
	}
}

religious_turmoil_end_trigger = {
	OR = {
		religious_unity > 0.90
		societal_value:spiritualist_vs_humanist > 90
		AND = {
			societal_value:spiritualist_vs_humanist < -60
			OR = {
				estate_satisfaction:clergy_estate > 0.6
				"estate_power(estate_type:clergy_estate)" > 0.20
			}
		}
	}
	stability > 30
}

revolution_disaster_end_trigger = {
	OR = {
		is_revolutionary = yes
		AND = {
			custom_tooltip = {
				text = revolution_disaster_end_trigger_tt
				NOT = { has_variable = revolution_rebel_var }
			}
			in_civil_war = no
		}
		trigger_if = {
			limit = { has_blocked_disaster_trigger = { type = revolution_disaster } }
			has_blocked_disaster_trigger = { type = revolution_disaster }
		}
	}
}

revolutionary_chaos_end_trigger = {
	in_civil_war = no
	OR = {
		is_revolutionary = no
		has_reform = government_reform:revolutionary_autocracy
		has_reform = government_reform:revolutionary_empire
		had_disaster_for_years = {
			disaster_type = scope:disaster
			years >= 10
		}
	}
}

rise_of_the_szlachta_end_trigger = {
	trigger_if = {
		limit = {
			has_variable = target_nobles_power_variable
			has_variable = target_burghers_power_variable
			has_variable = target_crown_power_variable
		}
		OR = {
			AND = {
				"estate_power(estate_type:nobles_estate)" > var:target_nobles_power_variable
				societal_value:aristocracy_vs_plutocracy <= -99
			} 
			AND = {
				"estate_power(estate_type:burghers_estate)" > var:target_burghers_power_variable
				societal_value:aristocracy_vs_plutocracy > 50
			}
			"estate_power(estate_type:crown_estate)" > var:target_crown_power_variable
			has_estate_privilege = estate_privilege:golden_liberty
		}
	}
	trigger_else = {
		OR = {
			AND = {
				custom_tooltip = given_more_estate_power_nobles_estate_power_tt
				societal_value:aristocracy_vs_plutocracy <= -99
			} 
			AND = {
				custom_tooltip = given_more_estate_power_burghers_estate_power_tt
				societal_value:aristocracy_vs_plutocracy > 50
			}
			custom_tooltip = given_more_estate_power_crown_estate_power_tt
			has_estate_privilege = estate_privilege:golden_liberty
		}
	}
}

savonarola_disaster_end_trigger = {
	OR = {
		character:flo_savonarola ?= { is_alive = no }
		government_type = government_type:theocracy
	}
}

sinicization_disaster_end_trigger = {
	OR = {
		is_subject = yes
		trigger_if = {
			limit = {
				country_exists = c:CHI
				OR = {
					NOT = { exists = international_organization:middle_kingdom }
					c:CHI = { is_leader_of_international_organization = international_organization:middle_kingdom }
				}
			}
			OR = {
				NOT = { country_exists = c:CHI }
				expected_army_size > c:CHI.expected_army_size
				country_total_army_levy_size >= c:CHI.country_total_army_levy_size
			}
		}
		trigger_else = {
			OR = {
				NOT = { exists = international_organization:middle_kingdom }
				NOT = { exists = international_organization:middle_kingdom.leader_country }
				expected_army_size > international_organization:middle_kingdom.leader_country.expected_army_size
				country_total_army_levy_size >= international_organization:middle_kingdom.leader_country.country_total_army_levy_size
			}
		}
		societal_value:sinicized_vs_unsinicized > 0
		custom_tooltip = {
			text = has_opted_to_side_with_china_in_events_tt
			var:china_side >= 30
		}
		custom_tooltip = {
			text = has_opted_to_stay_sovereign_from_china_in_events_tt
			var:sovereign_side >= 30
		}
	}
	at_war = no
}

struggle_for_royal_power_end_trigger = {
	OR = {
		in_civil_war = yes
		AND = {
			government_power > 70
			stability > 20
			"estate_power(estate_type:crown_estate)" > var:target_sfrp_crown_power_variable
		}
		has_estate_privilege = estate_privilege:liberum_veto
	}
}

byzantine_succession_crisis_end_trigger = {
	OR = {
		AND = {
			custom_tooltip = {
				text = no_pretender_rebel_active_tt
				NOT = {
					any_rebel = {
						rebel_category = pretender
					}
				}
			}
			stability > 30
			legitimacy > 55
		}
		custom_tooltip = {
			text = pretender_enforced_claim_tt
			has_variable = pretender_given_throne_variable
		}
		AND = {
			custom_tooltip = {
				text = pretender_is_cold_tt
				NOT = {
					any_character = {
						has_variable = scope_pretender_var
					}
				}
			}
			in_civil_war = no
		}
	}
}

succession_crisis_end_trigger = {
	OR = {
		NOT = { government_type = government_type:monarchy }
		in_civil_war = yes
		AND = {
			NOT = { any_rebel = { rebel_category = pretender } }
			legitimacy > 60
			stability > 25
		}
		custom_tooltip = {
			text = pretender_enforced_claim_tt
			has_variable = pretender_given_throne_variable
		}
		AND = {
			custom_tooltip = {
				text = pretender_is_cold_tt
				NOT = { 
					any_character = { 
						has_variable = scope_pretender_var 
						is_loyal = no 
					} 
				}
				NOT = { has_variable = choosing_new_pretender }
			}
			in_civil_war = no
		}
	}
}

horde_civil_war_end_trigger = {
	OR = {
		NOT = { government_type = government_type:steppe_horde }
		AND = {
			has_ruler = yes
			custom_tooltip = {
				text = horde_civil_war_end_trigger_no_rebels
				NOT = { any_rebel = { rebel_category = pretender } }
			}
			horde_unity > HORDE_CIVIL_WAR_END_HORDE_UNITY
			stability > HORDE_CIVIL_WAR_END_STABILITY
			in_civil_war = no
		}
	}
}

war_of_the_aragonese_union_disaster_end_trigger = {
	OR = {#The disaster can end if,
		#Or the privilege is granted
		has_estate_privilege = estate_privilege:union_privilege
		#Or we have started a civil war 
		#(if the civil war is because another issue this disaster breaks)
		in_civil_war = yes
		
		#Or all the rebels are destroyed
		NOT = {
			any_rebel = {
				rebel_category = estate
			}
		}
	}
}

war_of_the_roses_end_trigger = {
	OR = {
		AND = {
			NOT = { exists = scope:lancaster_rebel }
			NOT = { exists = scope:york_rebel }
			in_civil_war = no
		}
		AND = {
			NOT = {
				any_rebel = {
					rebel_category = pretender
				}
			}
			at_war = no
			has_ruler = yes
			legitimacy > 90
		}
	}
}

death_of_hayan_wuruk_end_trigger = {
	stability > 50
	government_power > 90
	trigger_if = {
		limit = { num_subjects > 0 }
		NOT = {
			any_subject = { liberty_desire > 50 }
		}
	}
}

decline_of_majapahit_trigger = {
	custom_tooltip = {
		text = decline_of_majapahit_timer_tt
		NOT = { has_variable = decline_of_majapahit_timer }
	}
	trigger_if = {
		limit = {
			has_variable = demak_progress
		}
		var:demak_progress <= 0.5
	}	
}

crisis_of_the_chinese_dynasty_end_trigger = {
	trigger_if = {
		limit = {
			exists = international_organization:middle_kingdom
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
		OR = {
			NOT = { is_leader_of_international_organization = international_organization:middle_kingdom }
			custom_tooltip = {
				text = ccd_celestial_authority_trigger
				international_organization:middle_kingdom = {
					var:celestial_authority > 90
				}
			}
			AND = {
				custom_tooltip = {
					text = cmd_has_reformed_cabinet_tt
					has_variable = reformed_the_cabinet_variable
				}
				custom_tooltip = {
					text = has_revised_tax_code_action_tt
					has_variable = completed_tax_revision_variable
				}
				custom_tooltip = {
					text = cmd_has_restored_stability_tt
					has_variable = cmd_restored_stability_variable
				}
				custom_tooltip = {
					text = cmd_has_strenthened_crown_tt
					has_variable = cmd_strengthened_crown_variable
				}
			}
		}
	}
	trigger_else = { always = yes }
}

court_and_country_end_trigger = {
	had_disaster_for_years = {
		disaster_type = disaster_type:court_and_country
		years >= 10
	}
	OR = {
		had_disaster_for_years = {
			disaster_type = disaster_type:court_and_country
			years > 20
		}
		AND = {
			"estate_power(estate_type:crown_estate)" >= var:final_crown_power_value_variable
			num_privileges <= var:final_privilege_number_variable
			societal_value:absolutism_vs_liberalism < -80
		}
		AND = {
			estate_satisfaction:nobles_estate >= {
				value = 0.65
				if = {
					limit = { root.societal_value:absolutism_vs_liberalism > 0 }
					subtract = {
						value = root.societal_value:absolutism_vs_liberalism
						multiply = 0.0015	#so if we have 100 Liberalism, we need only 50% estate satisfaction, whereas at 0 Liberalism it's 65%
					}
				}
			}
			estate_satisfaction:clergy_estate >= {
				value = 0.65
				if = {
					limit = { root.societal_value:absolutism_vs_liberalism > 0 }
					subtract = {
						value = root.societal_value:absolutism_vs_liberalism
						multiply = 0.0015	#so if we have 100 Liberalism, we need only 50% estate satisfaction, whereas at 0 Liberalism it's 65%
					}
				}
			}
			estate_satisfaction:burghers_estate >= {
				value = 0.65
				if = {
					limit = { root.societal_value:absolutism_vs_liberalism > 0 }
					subtract = {
						value = root.societal_value:absolutism_vs_liberalism
						multiply = 0.0015	#so if we have 100 Liberalism, we need only 50% estate satisfaction, whereas at 0 Liberalism it's 65%
					}
				}
			}
			estate_satisfaction:peasants_estate >= {
				value = 0.65
				if = {
					limit = { root.societal_value:absolutism_vs_liberalism > 0 }
					subtract = {
						value = root.societal_value:absolutism_vs_liberalism
						multiply = 0.0015	#so if we have 100 Liberalism, we need only 50% estate satisfaction, whereas at 0 Liberalism it's 65%
					}
				}
			}
			societal_value:absolutism_vs_liberalism > 50
		}
	}
}

aspiration_for_liberty_end_trigger = {
	OR = {
		has_country_modifier = reinstated_the_parliament_modifier
		trigger_if = {
			limit = { has_variable = aspiration_for_liberty_target_stability_variable }
			stability > var:aspiration_for_liberty_target_stability_variable
		}
		trigger_else = { stability > 75 }
	}
}

english_civil_war_end_trigger = {
	in_civil_war = no
	OR = {
		custom_tooltip = {
			text = lost_civil_war_tt
			has_variable = english_civil_war_lost_variable
		}
		custom_tooltip = {
			text = won_civil_war_tt
			has_variable = english_civil_war_won_variable
		}
		had_disaster_for_years = {
			disaster_type = disaster_type:english_civil_war
			years >= 10
		}
		NOT = { 
			any_rebel = { rebel_name_key = parliamentarist_rebels } 
		}
	}
	
}

french_wars_of_religion_end_trigger = {
	OR = {
		AND = {
			stability > 50
			religious_unity >= var:target_religious_unity_variable
		}
		had_disaster_for_years = {
			disaster_type = scope:disaster
			years >= 25
		}
		has_policy = edict_of_nantes
	}
}

time_of_troubles_end_trigger = {
	OR = {
		had_disaster_for_years = {
			disaster_type = disaster_type:time_of_troubles
			years >= 15
		}
		trigger_if = {
			limit = { 
				has_variable = time_of_troubles_stability_var
				has_variable = time_of_troubles_gov_power_var
			}
			AND = {
				stability > var:time_of_troubles_stability_var
				government_power > var:time_of_troubles_gov_power_var
			}
		}
		trigger_else = {
			stability >= 30
			government_power >= 75
		}
	}
}

decline_of_mali_end_trigger = {
	OR = {
		AND = {
			NOT = { any_rebel = { rebel_category = pretender } }
			at_war = no
			has_ruler = yes
			legitimacy > 90
			stability > 20
			num_locations > 35
		}
		num_locations < var:projected_num_locations_bad_variable
	}
}

decline_of_empire_end_trigger = {
	stability > 0
	had_disaster_for_years = {
		disaster_type = disaster_type:decline_of_empire
		years >= 10
	}
	OR = {
		average_control_in_home_region >= var:average_control_in_home_region_target_variable
		total_accepted_culture_population > {
			value = total_population
			divide = 2
		}		
	}
}

coup_attempt_end_trigger = {
	OR = {
		NOT = { government_type = government_type:monarchy }
		legitimacy >= {
			value = 65
			add = {
				value = stability
				multiply = -0.15
				ceiling = yes
			}
			max = 99	#High stability makes the disaster slightly easier and Low stability makes the disaster slightly harder
		}

		custom_tooltip = {
			text = is_a_conspirator
			any_character = {
				count <= 0
				has_variable = potential_conspirator_variable
			}
		}
		custom_tooltip = {
			text = conspirators_murdered_ruler_tt
			has_variable = murdered_ruler_variable
		}
		had_disaster_for_years = {
			disaster_type = scope:disaster
			years >= 5
		}			
	}
}