hussite_wars = {
	monthly_spawn_chance = monthly_spawn_chance_unique
	
	can_start = {	
		always = no #starts with event hussite_wars.2
	}
	
	can_end = {
		hussite_wars_unified_requirements = yes
	}
	
	visible = {
		OR = {
			religion = religion:hussite
			religion = religion:catholic
		}
	}

	on_start = {
		religion:catholic = {
			every_country_in_religion = {
				limit = {
					OR = {
						is_member_of_international_organization = international_organization:hre
						is_neighbor_of = c:BOH
					}
					OR = {
						is_subject_of = c:BOH 
						NOT = { is_allied_with = { target = c:BOH } }
					}
				}

				trigger_event_non_silently = hussite_wars.10
			}
		}

		set_variable = {
			name = months_since_start_variable
			value = 1
		}
	}

	on_monthly = { 
		random_list = {
			900 = {}
			50 = { c:BOH = { trigger_event_non_silently = hussite_wars.8 } }
			500 = {
				trigger = {
					c:PAP ?= {
						NOT = {	has_truce_with = c:BOH	}
						NOT = {	is_at_war_with = c:BOH	}
						at_war = no
						manpower_percentage > 0.9
						war_exhaustion < 1
					}
				}
				c:PAP = { trigger_event_non_silently = hussite_wars.9 }
			}
		}
		if = {
			limit = { has_variable = months_since_start_variable }
			change_variable = {
				name = months_since_start_variable
				add = 1
			}
		}
	}


	on_ended = {
		c:BOH ?= {
			every_other_country = {
				remove_opinion = {
					modifier = religious_disagreements_modifier
					target = c:BOH
				}
				remove_country_modifier = hussite_heresy_modifier
			}
			trigger_event_non_silently = hussite_wars.4
		}	
		
		if = {
			limit = {	#Tracking for the achievement house_of_hus
				country_exists = c:BOH
				c:BOH.religion = religion:hussite
			}
			set_global_variable = {
				name = victorious_hussites_variable
				years = 1
			}
		}
	}



	tooltip = {
		if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_of = c:BOH
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:BOH
						}
					}
				}
			}
			custom_tooltip = "HUSSITE_WARS_SIDE_BOHEMIA"
		}
		else_if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_of = c:PAP
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:PAP
						}
					}
				}
			}
			custom_tooltip = "HUSSITE_WARS_SIDE_POPE"
		}
		else_if = {
			limit = {
				has_owner = yes
				owner = c:PAP
			}
			custom_tooltip = pope_hw_tt
		}
		else_if = {
			limit = {
				has_owner = yes
				owner = c:BOH
			}
			custom_tooltip = boh_hw_tt
		}
	}

	map_color = {
		if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_or_below_of = c:BOH
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:BOH
						}
					}
				}
			}
			value = owner.country_color
		}
		else_if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_or_below_of = c:PAP
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:PAP
						}
					}
				}
			}
			value = owner.country_color
		}
		else_if = {
			limit = {
				has_owner = yes
				owner = c:PAP
			}
			value = owner.country_color
		}
		else_if = {
			limit = {
				has_owner = yes
				owner = c:BOH
			}
			value = owner.country_color
		}
		else = {
			value = define:NMapColors|DEFAULT_COLOR
		}
	}

	secondary_map_color = {
		if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_or_below_of = c:BOH
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:BOH
						}
					}
				}
			}
			value = c:BOH.country_color
		}
		else_if = {
			limit = {	
				has_owner = yes
				owner = {
					OR = {
						AND = {
							is_subject_or_below_of = c:PAP
							subject_loyalty > 50
						}
						has_mutual_scripted_relation = {
							type = relation_type:alliance
							target = c:PAP
						}
					}
				}
			}
			value = c:PAP.country_color
		}
	}
	
	legend_key = {
		limit = {
			has_owner = yes
			OR = {
				owner = c:BOH
				owner = c:PAP
			}
		}
	
		desc = "LOCATION_OWNER_NAME"
		color = owner.country_color
	}
}
