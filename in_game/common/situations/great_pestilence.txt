great_pestilence = {
	#https://en.wikipedia.org/wiki/Cocoliztli_epidemics
	#https://en.wikipedia.org/wiki/Columbian_exchange#Of_diseases
	#https://en.wikipedia.org/wiki/Native_American_disease_and_epidemics
	monthly_spawn_chance = monthly_spawn_chance_unique

	can_start = {
		disease_is_active = disease:great_pestilence
	}

	can_end = {
		#We make sure that all important regions have been infected before ending the situation
		var:var_carib_was_infected = yes
		var:var_mesoamerica_was_infected = yes
		var:var_andes_was_infected = yes
	}

	visible = {
		OR = {
			country_has_disease = disease:great_pestilence
			has_variable = had_great_pestilence
		}
	}

	on_start = {
		#Keep track of the most important regions
		set_variable = { name = var_carib_was_infected value = no }
		set_variable = { name = var_mesoamerica_was_infected value = no }
		set_variable = { name = var_andes_was_infected value = no }
	}

	on_monthly = {
		every_country = {
			limit = {
				country_has_disease = disease:great_pestilence
			}
			set_variable = { name = had_great_pestilence value = yes }
			random_list = {
				1 = { trigger_event_non_silently = great_pestilence.3 }
				1 = { trigger_event_non_silently = great_pestilence.4 }
				1 = { trigger_event_non_silently = great_pestilence.5 }
				1 = { trigger_event_non_silently = great_pestilence.6 }
				1 = { trigger_event_non_silently = great_pestilence.7 }
				50 = { }
			}
		}
		#Check if the disease has reached the important regions
		if = {
			limit = {
				var:var_carib_was_infected = no
				region:caribbean_region = {
					any_ownable_location_in_region = {
						disease_presence = { disease = disease:great_pestilence value > 0 }
					}
				}
			}
			set_variable = { name = var_carib_was_infected value = yes }
		}
		if = {
			limit = {
				var:var_mesoamerica_was_infected = no
				region:mesoamerica_region = {
					any_ownable_location_in_region = {
						disease_presence = { disease = disease:great_pestilence value > 0 }
					}
				}
			}
			set_variable = { name = var_mesoamerica_was_infected value = yes }
		}
		if = {
			limit = {
				var:var_andes_was_infected = no
				region:andes_region = {
					any_ownable_location_in_region = {
						disease_presence = { disease = disease:great_pestilence value > 0 }
					}
				}
			}
			set_variable = { name = var_andes_was_infected value = yes }
		}
	}

	tooltip = {
		if = {
			limit = {
				disease_presence = { disease = disease:great_pestilence value > 0 }
			}
			custom_tooltip = "GREAT_PESTILENCE_PRESENT_IN_LOCATION"
		}
	}

	on_ended = {
		every_country = {
			limit = {
				has_variable = had_great_pestilence
			}
			remove_country_modifier = no_contact_with_outsiders
			remove_country_modifier = procure_remedies
			remove_country_modifier = segregate_the_infected
			remove_country_modifier = blame_the_minorities
			remove_country_modifier = sponsor_spiritual_protection_bonus
			remove_country_modifier = sponsor_spiritual_protection_cost

			trigger_event_non_silently = great_pestilence.2
		}
		every_market_in_world = {
			limit = {
				location.continent = continent:america
				has_temporary_demand = demand:procure_remedies 
				has_temporary_demand = demand:procure_remedies_no_liquor 
			}
			remove_temporary_demand = demand:procure_remedies
			remove_temporary_demand = demand:procure_remedies_no_liquor
		}
	}

	is_data_map = yes
	map_color = {
		if = {
			limit = {
				disease_presence = { disease = disease:great_pestilence value > 0 }
			}
			lerp = {
				min_color = rgb { 248  180  194 }
				max_color = rgb { 61 0 0 }
				factor = "disease_presence(disease:great_pestilence)"
			}
		}
		else = {
			value = define:NMapColors|DEFAULT_COLOR
		}
	}
	
	legend_key = { 
		desc = "great_pestilence"
		color = rgb { 61 0 0 }
	}
}
