peace_gag_force_faction_change = {
	blocks_full_annexation = yes
	cost = {
		add = {
			desc = "DIPLOREASON_BASE"
			value = 5
		}
		add = {
			desc = "game_concept_prestige"
			value = scope:loser.prestige
			multiply = 0.5
		}
	}

	potential = {
		scope:war = {
			or = {
				has_casus_belli = no
				casus_belli = {
					is_trade_cb = no
				}
			}
		}
		OR = {
			AND = {
				scope:winner = { is_member_of_international_organization_of_type = { type = guelphs_io } }
				scope:loser = { NOT = { is_member_of_international_organization_of_type = { type = guelphs_io } } }
			}
			AND = {
				scope:winner = { is_member_of_international_organization_of_type = { type = ghibellines_io } }
				scope:loser = { NOT = { is_member_of_international_organization_of_type = { type = ghibellines_io } } }
			}
		}
	}
	allow = {
		trigger_if = {
			limit = {
				scope:winner = { is_member_of_international_organization_of_type = { type = guelphs_io } }
				scope:loser = { NOT = { is_member_of_international_organization_of_type = { type = ghibellines_io } } }
			}
			scope:loser = { can_join_international_organization = international_organization:guelphs_io }
		}
		trigger_if = {
			limit = {
				scope:winner = { is_member_of_international_organization_of_type = { type = ghibellines_io } }
				scope:loser = { NOT = { is_member_of_international_organization_of_type = { type = guelphs_io } } }
			}
			scope:loser = { can_join_international_organization = international_organization:ghibellines_io }
		}
	}
	effect = {
		hidden_effect = {
			if = {
				limit = { scope:loser = { is_member_of_international_organization_of_type = { type = guelphs_io } } }
				leave_situation_faction = {
					target = scope:loser
					international_organization = international_organization:guelphs_io
					leave_variable = gag_recently_left_a_faction
					leave_years = 2
					join_variable = gag_recently_joined_a_faction
				}
			}
			if = {
				limit = { scope:loser = { is_member_of_international_organization_of_type = { type = ghibellines_io } } }
				leave_situation_faction = {
					target = scope:loser
					international_organization = international_organization:ghibellines_io
					leave_variable = gag_recently_left_a_faction
					leave_years = 2
					join_variable = gag_recently_joined_a_faction
				}
			}
		}
		if = {
			limit = { scope:winner = { is_member_of_international_organization_of_type = { type = guelphs_io } } }
			join_situation_faction = {
				target = scope:loser
				international_organization = international_organization:guelphs_io
				join_variable = gag_recently_joined_a_faction
				join_years = 5
				leave_variable = gag_recently_left_a_faction
			}
		}
		if = {
			limit = { scope:winner = { is_member_of_international_organization_of_type = { type = ghibellines_io } } }
			join_situation_faction = {
				target = scope:loser
				international_organization = international_organization:ghibellines_io
				join_variable = gag_recently_joined_a_faction
				join_years = 5
				leave_variable = gag_recently_left_a_faction
			}
		}
		scope:winner = {
			add_prestige = {
				value = scope:loser.prestige
				multiply =  0.05
			}
		}
		scope:loser = { 
			add_prestige = prestige_weak_penalty 
			set_variable = {
				name = gag_recently_joined_a_faction
				value = scope:recipient
				years = 5
			}
		}
	}
	ai_desire = {
		if = {
			limit = {
				scope:winner = {
					is_rival_of = scope:loser
				}
			}
			add = {
				desc = "game_concept_rival"
				value = 10
			}
		}
		if = {
			limit = {
				scope:winner.prestige < scope:loser.prestige
			}
			add = {
				desc = "DIPLOREASON_LOWER_PRESTIGE"
				value = scope:loser.prestige
				subtract = scope:winner.prestige
			}
		}
	}
}

