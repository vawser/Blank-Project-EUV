cognatic_primogeniture = {
	include_ruler_siblings = yes
	through_female = yes
	allow_female = yes
	allow_children = yes
	ignore_ruler = yes
	potential = {
	}
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}
			add = {
				desc = "HEIR_SELECTION_LEGALLY_MALE_DESC"
				if = {
					limit = {
						is_a_praefecta = yes
					}
					value = 100
				}
			}


			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_LEGALLY_MALE_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				value = -1000
			}
		}
	}
}

absolute_cognatic_primogeniture = {
	include_ruler_siblings = yes
	through_female = yes
	allow_female = yes
	allow_children = yes
	ignore_ruler = yes
	potential = {
	}
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}


salic_law = {
	include_ruler_siblings = yes
	through_female = no
	allow_female = no
	allow_children = yes
	ignore_ruler = yes

	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}

	potential = {
	}

	traverse_family_tree = yes
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}

semi_salic_law = {
	include_ruler_siblings = yes
	through_female = yes
	allow_female = no
	allow_children = yes
	ignore_ruler = yes

	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes

	potential = {
	}

	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}

partition_inheritance = {
	include_ruler_siblings = yes
	through_female = no
	allow_female = no
	allow_children = yes
	ignore_ruler = yes
	custom_tags = { cannot_be_transferred }

	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}

	potential = {
	}

	locked = {
		# you cannot swap to another heir selection if this is true
		has_estate_privilege = estate_privilege:right_to_inherit
	}

	succession_effect = {
		# an effect that happens right after succession occurs, but before candidates are recalculated
		# useful scopes: root = country scope:old_ruler scope:new_ruler
		if = {
			limit = {
				has_variable = ignore_succesion_effect
			}
			remove_variable = ignore_succesion_effect
		}
		else = {
			trigger_event_silently = succession.100 #Partition Inheritance Event
		}
	}

	traverse_family_tree = yes
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}

youngest_son_of_ruler = {
	through_female = no
	allow_female = no
	allow_children = yes
	ignore_ruler = yes

	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes

	potential = {
	}
	
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}

			add = {
				desc = "HEIR_SELECTION_YOUNGER_HEIR_DESC"
				value = 100
				subtract = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}

			add = {
				desc = "HEIR_SELECTION_YOUNGER_HEIR_DESC"
				value = 1
			}
		}
	}
}

tanistry_elective = {
	include_ruler_siblings = yes
	all_in_dynasty = yes
	through_female = no
	allow_female = yes	
	allow_children = no
	ignore_ruler = yes

	allowed_estates = { nobles_estate }
	heir_is_allowed = {
		is_ruler = no
	}
	potential = {
        always = no
	}

	succession_effect = {
		add_legitimacy = legitimacy_mild_penalty
	}

	calc = {

		if = {
			limit = {
				exists = root
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = root.character_age
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = root.adm
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = root.dip
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = root.mil
			}
			
			if = {
				limit = { is_female = yes }
				add = {
					desc = "HEIR_SELECTION_FEMALE_DESC"
					value = -100
				}
			}
			
			if = {
				limit = { 
					NOT = {
						scope:target ?= {
							any_primary_or_accepted_culture = { root.culture = this }
						}
					} 
				}
				add = {
					desc = "HEIR_SELECTION_NON_ACCEPTED_CULTURE_DESC"
					value = -100
				}
			}

			if = {
				limit = { exists = root.father }
				
				if = {
					limit = {
						any_parent = {
							this = scope:target.ruler
						}
					}
					add = {
						# it was seen as bad form to elect the current ruler's son
						desc = "HEIR_SELECTION_PARENT_IS_CURRENT_RULER_DESC"
						value = -100
					}
				}				
				else = {
					if = {
						limit = { 
							root.father = {
								is_alive = no
								any_ruling_countries ?= {
									this ?= scope:target
								}
							}
						}
						add = {
							desc = "HEIR_SELECTION_FATHER_WAS_HISTORICAL_RULER_DESC"
							value = 100
						}
					}
				}
						
				if = {
					limit = {
						exists = root.father.father
						root.father.father = {
							is_alive = no
							any_ruling_countries ?= {
								this ?= scope:target
							}
						}
					}
					add = {
						desc = "HEIR_SELECTION_GRANDFATHER_WAS_HISTORICAL_RULER_DESC"
						value = 100
					}
				}
			}
			
			if = {
				limit = { 
					OR = {
						is_general = yes
						is_admiral = yes
					}
				}
				add = {
					desc = "HEIR_SELECTION_GENERAL_OR_ADMIRAL_DESC"
					value = 50
				}
			}
			
			if = {
				limit = { 
					OR = {
						has_trait_category = general
						has_trait_category = admiral
					}
				}
				add = {
					desc = "HEIR_SELECTION_GENERAL_OR_ADMIRAL_TRAIT_DESC"
					value = 50
				}
			}
			if = { 
				limit = { modifier:blocked_from_being_ruler = yes }
				add = {
					desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
					value = -1000 
				}
			}
		}

		
		# Here it goes the description for explaining the ability
		if = {
			limit = {
				not = { exists = root }
			}
			add = {
				desc = "HEIR_SELECTION_GRANDFATHER_WAS_HISTORICAL_RULER_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_FATHER_WAS_HISTORICAL_RULER_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_PARENT_IS_CURRENT_RULER_DESC"
				value = -100
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = 1
			}
			
			add = { 
				desc = "HEIR_SELECTION_FEMALE_DESC"
				value = -100
			}
			add = {
				desc = "HEIR_SELECTION_NON_ACCEPTED_CULTURE_DESC"
				value = -100
			}
			add = {
				desc = "HEIR_SELECTION_GENERAL_OR_ADMIRAL_DESC"
				value = 50
			}
			add = {
				desc = "HEIR_SELECTION_GENERAL_OR_ADMIRAL_TRAIT_DESC"
				value = 50
			}
		}
	}
}

elective_succession = {
	use_election = yes
	include_ruler_siblings = yes
	all_in_country = yes
	all_in_dynasty = yes
	through_female = yes
	ignore_ruler = yes
	allow_female = yes
	term_duration = 0	#0 = until ruler death
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	potential = {
		has_unlocked_heir_selection_trigger = { type = elective_succession }
	}
	locked = {
        always = no
	}
	max_possible_candidates = 3
	succession_effect = {
		add_legitimacy = legitimacy_mild_penalty
	}

	calc = {
		if = {
			limit = {
				exists = root
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = root.adm
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = root.dip
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = root.mil
			}
			
			if = {
				limit = { is_female = yes }
				add = {
					desc = "HEIR_SELECTION_FEMALE_DESC"
					value = -100
				}
			}

			if = {
				limit = { exists = root.father }
				
				if = {
					limit = {
						any_parent = {
							this = scope:target.ruler
						}
					}
					add = {
						desc = "HEIR_SELECTION_PARENT_IS_CURRENT_RULER_DESC"
						value = 100
					}
				}				
				else = {
					if = {
						limit = { 
							scope:target = { 
								any_ruler = { 
									is_alive = no
									root.father = this 
								} 
							}
						}
						add = {
							desc = "HEIR_SELECTION_FATHER_WAS_HISTORICAL_RULER_DESC"
							value = 100
						}
					}
				}
			}
			if = { 
				limit = { modifier:blocked_from_being_ruler = yes }
				add = {
					desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
					value = -1000 
				}
			}
		}
		if = {
			limit = {
				NOT = { exists = root }
			}
			add = {
				desc = "HEIR_SELECTION_FATHER_WAS_HISTORICAL_RULER_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_PARENT_IS_CURRENT_RULER_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = 1
			}
			add = { 
				desc = "HEIR_SELECTION_FEMALE_DESC"
				value = -100
			}
			add = {
				desc = "HEIR_SELECTION_NON_ACCEPTED_CULTURE_DESC"
				value = -100
			}
		}
	}
}

dynastic_elective_succession = {
	use_election = yes
	include_ruler_siblings = yes
	all_in_country = no
	all_in_dynasty = yes
	through_female = yes
	ignore_ruler = yes
	allow_female = no
	max_possible_candidates = 5
	term_duration = 0	#0 = until ruler death
	show_candidates = no
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	locked = {
		# you cannot swap to another heir selection if this is true
		estate_satisfaction:nobles_estate < 0.8
	}
	potential = {
		has_unlocked_heir_selection_trigger = { type = dynastic_elective_succession }
	}

	succession_effect = {
		add_legitimacy = legitimacy_mild_penalty
	}

	calc = {
		if = {
			limit = {
				exists = root
			}
			add = {
				desc = "HEIR_SELECTION_RANDOM_DESC"
				value = random_integer
				modulo = 200
				
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = root.adm
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = root.dip
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = root.mil
			}
			
			if = { 
				limit = { modifier:blocked_from_being_ruler = yes }
				add = {
					desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
					value = -1000 
				}
			}
		}
		# Here it goes the description for explaining the selection
		if = {
			limit = {
				NOT = { exists = root }
			}
			add = {
				desc = "HEIR_SELECTION_RANDOM_DESC"
				format = "FORMAT_NO_VALUE"
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = 1
			}
		}
	}
}

favorite_son_elective_succession = {
	include_ruler_siblings = yes
	through_female = no
	allow_female = no
	allow_children = yes
	ignore_ruler = yes
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes

	potential = {
	}
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = root.adm
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = root.dip
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = root.mil
			}
			#bonus for appointed heir
			add = {
				desc = "HEIR_SELECTION_APPOINTED_HEIR_DESC"
				if = {
					limit = {
						has_character_modifier = appoint_as_heir_modifier
					}
					value = 200
				}
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_ADM_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_DIP_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_MIL_DESC"
				value = 1
			}
			add = {
				desc = "HEIR_SELECTION_APPOINTED_HEIR_DESC"
				value = 200
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}

union_of_crowns_succession = {
	include_ruler_siblings = yes
	through_female = no
	allow_female = no
	allow_children = yes
	ignore_ruler = yes
	allowed_estates = { nobles_estate }
	custom_tags = { cannot_be_transferred }
	heir_is_allowed = {
		OR = {
			estate_type = estate_type:crown_estate
			estate_type = estate_type:nobles_estate
		}
		OR = {
			owner ?= scope:target
			is_ruler = yes
		}
	}
	traverse_family_tree = yes
	calc = {
		if = {
			limit = {
				exists = root
			}

			add = {
				desc = "HEIR_SELECTION_IS_RULER"
				if = {
					limit = {
						is_ruler = yes
					}
					value = 100
				}
			}
			
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_IS_DIRECT_MALE_DESCENDANT"
				if = {
					limit = {
						is_female = no
						owner = {
							has_ruler = yes
							ruler ?= {
								any_descendant = {
									this = root
								}
							}
						}
					}
					value = 200
				}
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_IS_RULER"
				value = 100
			}

			add = {
				desc = "HEIR_SELECTION_IS_DIRECT_MALE_DESCENDANT"
				value = 200
			}

			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			if = {
				limit = {
					is_female = no
					owner = {
						has_ruler = yes
						ruler ?= {
							any_descendant = {
								this = root
							}
						}
					}
				}
				if = {
					limit = {
						father ?= owner.ruler
					}
					#bonus for sons
					add = {
						desc = "HEIR_SELECTION_IS_RULER_SON_DESC"
						value = 200
					}
				}
				else_if = {
					limit = {
						father ?= {
							father ?= owner.ruler
						}
					}
					#bonus for sons
					add = {
						desc = "HEIR_SELECTION_IS_RULER_GRANDSON_DESC"
						value = 100
					}
				}
				#bonus for males
				add = {
					desc = "HEIR_SELECTION_IS_DIRECT_MALE_DESCENDANT"
					value = 200
				}
				add = {
					desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
					value = character_age
				}
			}
			else_if = {
				limit = {
					is_female = no
					is_ruler = yes
				}
				add = {
					desc = "HEIR_SELECTION_IS_RULER_DESC"
					value = 100
				}
			}

			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_IS_DIRECT_MALE_DESCENDANT"
				value = 200
			}
			add = {
				desc = "HEIR_SELECTION_IS_RULER_SON_DESC"
				value = 200
			}			
			add = {
				desc = "HEIR_SELECTION_IS_RULER_GRANDSON_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_IS_RULER_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
	include_other_countries = {
		has_mutual_scripted_relation = { type = relation_type:union_of_crowns_pact target = scope:target }
	}

	locked = {
		# you cannot swap to another heir selection if this is true
		OR = {
			succession_law = heir_selection:union_of_crowns_succession
			current_year < 1400
		}
	}
	potential = {
		succession_law = heir_selection:union_of_crowns_succession
	}
	succession_effect = {
		custom_tooltip = union_of_crowns_succession_tt
	}
}

matrilineal_salic_law = {
	include_ruler_siblings = yes
	through_female = yes
	allow_female = no
	allow_children = yes
	ignore_ruler = yes
	allowed_estates = { nobles_estate }
	heir_is_allowed = {
	}
	traverse_family_tree = yes
	all_in_dynasty = yes

	potential = {
        
	}
	sibling_score = {
		if = {
			limit = {
				exists = root
			}
			#massive bonus if their mother was part of the dynasty
			add = {
				desc = "HEIR_SELECTION_MATRILINEAL"
				if = {
					limit = {
						exists = mother
						mother = {
							OR = {
								is_ruler = yes
								AND = {
									has_dynasty = yes
									dynasty = root.dynasty
								}
							}
						}
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 300
				}
			}
			#bonus for males
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				if = {
					limit = {
						OR = {
							not = { exists = root }
							is_female = no
						}
					}
					value = 100
				}
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = character_age
			}
			add = {
				desc = "HEIR_SELECTION_IS_UNSUITED_TO_RULE_DESC"
				if = { limit = { modifier:blocked_from_being_ruler = yes } value = -1000 }
			}
		}
		else = {
			#description
			add = {
				desc = "HEIR_SELECTION_MALE_DESC"
				value = 100
			}
			add = {
				desc = "HEIR_SELECTION_OLDER_HEIR_DESC"
				value = 1
			}
		}
	}
}


