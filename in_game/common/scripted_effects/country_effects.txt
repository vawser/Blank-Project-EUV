create_newborn_ruler_child = {
	custom_tooltip = new_child_for_ruler
	hidden_effect = {
		create_character = {
			dynasty = root.ruler.dynasty
			culture = root.ruler.culture
			religion = root.ruler.religion
			father = root.ruler
			age = 0
			no_stats = yes
			trait_category = none
		}
	}
}

create_newborn_female_ruler_child = {
	custom_tooltip = new_child_for_ruler
	hidden_effect = {
		create_character = {
			dynasty = root.ruler.dynasty
			culture = root.ruler.culture
			religion = root.ruler.religion
			mother = root.ruler
			age = 0
			no_stats = yes
			trait_category = none
		}
	}
}

parliament_debate_failed_effect = {
	add_stability = stability_mild_penalty
}

unlock_advance_effect = {
	custom_description = {
		text = unlock_advance_effect
		value = advance_type:$type$
		set_variable = {
			name = unlocked_advance_$type$
			value = yes
		}
	}
}
lock_advance_effect = {
	custom_description = {
		text = lock_advance_effect
		value = advance_type:$type$
		remove_variable = unlocked_advance_$type$
	}
}

unlock_government_reform_effect = {
	custom_description = {
		text = unlock_government_reform_effect
		value = government_reform:$type$
		set_variable = {
			name = unlocked_government_reform_$type$
			value = yes
		}
	}
}
lock_government_reform_effect = {
	custom_description = {
		text = lock_government_reform_effect
		value = government_reform:$type$
		remove_variable = unlocked_government_reform_$type$
	}
}

unlock_estate_privilege_effect = {
	custom_description = {
		text = unlock_estate_privilege_effect
		value = estate_privilege:$type$
		set_variable = {
			name = unlocked_estate_privilege_$type$
			value = yes
		}
	}
}
lock_estate_privilege_effect = {
	custom_description = {
		text = lock_estate_privilege_effect
		value = estate_privilege:$type$
		remove_variable = unlocked_estate_privilege_$type$
	}
}

unlock_heir_selection_effect = {
	custom_description = {
		text = unlock_heir_selection_effect
		value = heir_selection:$type$
		set_variable = {
			name = unlocked_heir_selection_$type$
			value = yes
		}
	}
}
lock_heir_selection_effect = {
	custom_description = {
		text = lock_heir_selection_effect
		value = heir_selection:$type$
		remove_variable = unlocked_heir_selection_$type$
	}
}

unlock_law_effect = {
	custom_description = {
		text = unlock_law_effect
		value = law:$type$
		set_variable = {
			name = unlocked_law_$type$
			value = yes
		}
	}
}
lock_law_effect = {
	custom_description = {
		text = lock_law_effect
		value = law:$type$
		remove_variable = unlocked_law_$type$
	}
}

unlock_policy_effect = {
	custom_description = {
		text = unlock_policy_effect
		value = policy:$type$
		set_variable = {
			name = unlocked_policy_$type$
			value = yes
		}
	}
}
lock_policy_effect = {
	custom_description = {
		text = lock_policy_effect
		value = policy:$type$
		remove_variable = unlocked_policy_$type$
	}
}

unlock_character_interaction_effect = {
	custom_description = {
		text = unlock_character_interaction_effect
		value = character_interaction:$type$
		set_variable = {
			name = unlocked_character_interaction_$type$
			value = yes
		}
	}
}
lock_character_interaction_effect = {
	custom_description = {
		text = lock_character_interaction_effect
		value = character_interaction:$type$
		remove_variable = unlocked_character_interaction_$type$
	}
}

unlock_country_interaction_effect = {
	custom_description = {
		text = unlock_country_interaction_effect
		value = country_interaction:$type$
		set_variable = {
			name = unlocked_country_interaction_$type$
			value = yes
		}
	}
}
lock_country_interaction_effect = {
	custom_description = {
		text = lock_country_interaction_effect
		value = country_interaction:$type$
		remove_variable = unlocked_country_interaction_$type$
	}
}

unlock_generic_action_effect = {
	custom_description = {
		text = unlock_generic_action_effect
		value = generic_action:$type$
		set_variable = {
			name = unlocked_generic_action_$type$
			value = yes
		}
	}
}
lock_generic_action_effect = {
	custom_description = {
		text = lock_generic_action_effect
		value = generic_action:$type$
		remove_variable = unlocked_generic_action_$type$
	}
}

unlock_cabinet_action_effect = {
	custom_description = {
		text = unlock_cabinet_action_effect
		value = cabinet_action:$type$
		set_variable = {
			name = unlocked_cabinet_action_$type$
			value = yes
		}
	}
}
lock_cabinet_action_effect = {
	custom_description = {
		text = lock_cabinet_action_effect
		value = cabinet_action:$type$
		remove_variable = unlocked_cabinet_action_$type$
	}
}

unlock_building_effect = {
	custom_description = {
		text = unlock_building_effect
		value = building_type:$type$
		set_variable = {
			name = unlocked_building_$type$
			value = yes
		}
	}
}
lock_building_effect = {
	custom_description = {
		text = lock_building_effect
		value = building_type:$type$
		remove_variable = unlocked_building_$type$
	}
}

unlock_unit_effect = {
	custom_description = {
		text = unlock_unit_effect
		value = unit_type:$type$
		set_variable = {
			name = unlocked_unit_$type$
			value = yes
		}
	}
}
lock_unit_effect = {
	custom_description = {
		text = lock_unit_effect
		value = unit_type:$type$
		remove_variable = unlocked_unit_$type$
	}
}

unlock_levy_effect = {
	custom_description = {
		text = unlock_levy_effect
		value = levy_setup:$type$
		set_variable = {
			name = unlocked_levy_$type$
			value = yes
		}
	}
}
lock_levy_effect = {
	custom_description = {
		text = lock_levy_effect
		value = levy_setup:$type$
		remove_variable = unlocked_levy_$type$
	}
}

unlock_parliament_issue_effect = {
	custom_description = {
		text = unlock_parliament_issue_effect
		value = parliament_issue:$type$
		set_variable = {
			name = unlocked_parliament_issue_$type$
			value = yes
		}
	}
}
lock_parliament_issue_effect = {
	custom_description = {
		text = lock_parliament_issue_effect
		value = parliament_issue:$type$
		remove_variable = unlocked_parliament_issue_$type$
	}
}

unlock_parliament_agenda_effect = {
	custom_description = {
		text = unlock_parliament_agenda_effect
		value = parliament_agenda:$type$
		set_variable = {
			name = unlocked_parliament_agenda_$type$
			value = yes
		}
	}
}
lock_parliament_agenda_effect = {
	custom_description = {
		text = lock_parliament_agenda_effect
		value = parliament_agenda:$type$
		remove_variable = unlocked_parliament_agenda_$type$
	}
}

unlock_parliament_type_effect = {
	custom_description = {
		text = unlock_parliament_type_effect
		value = parliament_type:$type$
		set_variable = {
			name = unlocked_parliament_type_$type$
			value = yes
		}
	}
}
lock_parliament_type_effect = {
	custom_description = {
		text = lock_parliament_type_effect
		value = parliament_type:$type$
		remove_variable = unlocked_parliament_type_$type$
	}
}

unlock_peace_treaty_effect = {
	custom_description = {
		text = unlock_peace_treaty_effect
		value = peace_treaty:$type$
		set_variable = {
			name = unlocked_peace_treaty_$type$
			value = yes
		}
	}
}
lock_peace_treaty_effect = {
	custom_description = {
		text = lock_peace_treaty_effect
		value = peace_treaty:$type$
		remove_variable = unlocked_peace_treaty_$type$
	}
}

unlock_casus_belli_effect = {
	custom_description = {
		text = unlock_casus_belli_effect
		value = casus_belli:$type$
		set_variable = {
			name = unlocked_casus_belli_$type$
			value = yes
		}
	}
}
lock_casus_belli_effect = {
	custom_description = {
		text = lock_casus_belli_effect
		value = casus_belli:$type$
		remove_variable = unlocked_casus_belli_$type$
	}
}

unlock_relation_type_effect = {
	custom_description = {
		text = unlock_relation_type_effect
		value = relation_type:$type$
		set_variable = {
			name = unlocked_relation_type_$type$
			value = yes
		}
	}
}
lock_relation_type_effect = {
	custom_description = {
		text = lock_relation_type_effect
		value = relation_type:$type$
		remove_variable = unlocked_relation_type_$type$
	}
}

enable_disaster_effect = {
	custom_description = {
		text = enable_disaster_effect_text
		value = disaster_type:$type$
		set_variable = {
			name = enabled_disaster_$type$
			value = yes
		}
	}
}
disable_disaster_effect = {
	custom_description = {
		text = disable_disaster_effect_text
		value = disaster_type:$type$
		remove_variable = enabled_disaster_$type$
	}
}
block_disaster_effect = {
	custom_description = {
		text = block_disaster_effect_text
		value = disaster_type:$type$
		set_variable = {
			name = blocked_disaster_$type$
			value = yes
		}
	}
}
block_disaster_temporarily_effect = {
	custom_description = {
		text = block_disaster_temporarily_effect_text
		value = $years$
		object = disaster_type:$type$
		set_variable = {
			name = blocked_disaster_$type$
			days = $years_in_days$
			value = yes
		}
	}
}

unlock_artist_type_effect = {
	custom_description = {
		text = unlock_artist_type_effect
		value = artist_type:$type$
		set_variable = unlocked_artist_type_$type$
	}
}
lock_artist_type_effect = {
	custom_description = {
		text = lock_artist_type_effect
		value = artist_type:$type$
		remove_variable = unlocked_artist_type_$type$
	}
}

unlock_work_of_art_definition_effect = {
	custom_description = {
		text = unlock_work_of_art_definition_effect
		value = work_of_art_type:$type$
		set_variable = unlocked_work_of_art_definition_$type$
	}
}
lock_work_of_art_definition_effect = {
	custom_description = {
		text = lock_work_of_art_definition_effect
		value = work_of_art_type:$type$
		remove_variable = unlocked_work_of_art_definition_$type$
	}
}

unlock_child_education_effect = {
    custom_description = {
        text = unlock_child_education_effect
        value = child_education:$type$
        set_variable = unlocked_child_education_$type$
    }
}
lock_child_education_effect = {
    custom_description = {
        text = lock_child_education_effect
        value = child_education:$type$
        remove_variable = unlocked_child_education_$type$
    }
}

unlock_mission_effect = {
    custom_description = {
        text = unlock_mission_effect
        value = mission:$type$
        set_variable = unlocked_mission_$type$
    }
}
lock_mission_effect = {
    custom_description = {
        text = lock_mission_effect
        value = mission:$type$
        remove_variable = unlocked_mission_$type$
    }
}

disable_mission_effect = {
	custom_description = {
		text = disable_mission_effect
        value = mission:$type$
		set_variable = disabled_mission_$type$
	}
}
enable_mission_effect = {
	custom_description = {
		text = enable_mission_effect
        value = mission:$type$
		remove_variable = disabled_mission_$type$
	}
}

unlock_mission_task_effect = {
    custom_description = {
        text = unlock_mission_task_effect
        value = mission_task:$type$
        set_variable = unlocked_mission_task_$type$
    }
}
lock_mission_task_effect = {
    custom_description = {
        text = lock_mission_task_effect
        value = mission_task:$type$
        remove_variable = unlocked_mission_task_$type$
    }
}

unlock_recruitment_method_effect = {
    custom_description = {
        text = unlock_recruitment_method_effect
        value = recruitment_method:$type$
        set_variable = unlocked_recruitment_method_$type$
    }
}
lock_recruitment_method_effect = {
    custom_description = {
        text = lock_recruitment_method_effect
        value = recruitment_method:$type$
        remove_variable = unlocked_recruitment_method_$type$
    }
}

unlock_regency_type_effect = {
    custom_description = {
        text = unlock_regency_type_effect
        value = regency_type:$type$
        set_variable = unlocked_regency_type_$type$
    }
}
lock_regency_type_effect = {
    custom_description = {
        text = lock_regency_type_effect
        value = regency_type:$type$
        remove_variable = unlocked_regency_type_$type$
    }
}

unlock_unit_ability_effect = {
    custom_description = {
        text = unlock_unit_ability_effect
        value = unit_ability:$type$
        set_variable = unlocked_unit_ability_$type$
    }
}
lock_unit_ability_effect = {
    custom_description = {
        text = lock_unit_ability_effect
        value = unit_ability:$type$
        remove_variable = unlocked_unit_ability_$type$
    }
}

unlock_societal_value_effect = {
    custom_description = {
        text = unlock_societal_value_effect
        value = societal_value_type:$type$
        set_variable = unlocked_societal_value_$type$
    }
}
lock_societal_value_effect = {
    custom_description = {
        text = lock_societal_value_effect
        value = societal_value_type:$type$
        remove_variable = unlocked_societal_value_$type$
    }
}

unlock_production_method_effect = {
    custom_description = {
        text = unlock_production_method_effect
        value = production_method:$type$
        set_variable = unlocked_production_method_$type$
    }
}
lock_production_method_effect = {
    custom_description = {
        text = lock_production_method_effect
        value = production_method:$type$
        remove_variable = unlocked_production_method_$type$
    }
}

lots_of_hussites = {
	every_owned_location = {
		limit = { region = root.capital.region }
		every_pop = {
			limit = { religion = religion:catholic }
			random_list = {
				20 = {
					split_pop = {
						fraction = 0.1
						religion = religion:hussite
					}
				}
				20 = {
					split_pop = {
						fraction = 0.2
						religion = religion:hussite
					}
				}
				20 = {
					split_pop = {
						fraction = 0.4
						religion = religion:hussite
					}
				}
				20 = {
					split_pop = {
						fraction = 0.55
						religion = religion:hussite
					}
				}
				10 = {
					split_pop = {
						fraction = 0.70
						religion = religion:hussite
					}
				}
				10 = {
					split_pop = {
						fraction = 0.9
						religion = religion:hussite
					}
				}
			}
		}
	}
}

add_opinion_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		add_opinion = {
			target = $target$
			modifier = $modifier$
		}
		reverse_add_opinion = {
			target = $target$
			modifier = $modifier$
		}
	}
}

add_trust_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		add_trust = {
			target = $target$
			modifier = $modifier$
		}
		reverse_add_trust = {
			target = $target$
			modifier = $modifier$
		}
	}
}

add_casus_belli_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		add_casus_belli = {
			target = $target$
			type = $type$
		}
		$target$ = {
			add_casus_belli = {
				target = prev
				type = $type$
			}
		}
	}
}

remove_opinion_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		if = {
			limit = {
				has_opinion = {
					target = $target$
					modifier = $modifier$
				}
			}
			remove_opinion = {
				target = $target$
				modifier = $modifier$
			}
		}
		if = {
			limit = {
				$target$ = {
					has_opinion = {
						target = PREV
						modifier = $modifier$
					}
				}
			}
			$target$ = {
				remove_opinion = {
					target = PREV
					modifier = $modifier$
				}
			}
		}
	}
}

remove_trust_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		if = {
			limit = {
				has_trust = {
					target = $target$
					modifier = $modifier$
				}
			}
			remove_trust = {
				target = $target$
				modifier = $modifier$
			}
		}
		if = {
			limit = {
				$target$ = {
					has_trust = {
						target = PREV
						modifier = $modifier$
					}
				}
			}
			$target$ = {
				remove_trust = {
					target = PREV
					modifier = $modifier$
				}
			}
		}
	}
}

remove_casus_belli_mutual_effect = {
	if = {
		limit = { NOT = { this = $target$ } }
		remove_casus_belli = {
			target = $target$
			type = $type$
		}
		$target$ = {
			remove_casus_belli = {
				target = prev
				type = $type$
			}
		}
	}
}

turn_japanese_clan_into_normal_tag = {
	custom_tooltip = {
		text = turn_japanese_clan_into_normal_tag.tt
		if = {
			limit = { has_reform = government_reform:japanese_clan }
			remove_reform = government_reform:japanese_clan
			add_reform = government_reform:daimyo
		}
		change_country_type = location
		save_temporary_scope_as = target_clan
		every_owned_foreign_building_location = {
			if = {
				limit = { 
					this != location:kyoto
					can_clan_get_this_location_when_turning_into_normal_tag = yes
				}
				change_location_owner = prev
				add_core = prev
				change_integration_level = core
			}
			every_foreign_buildings_in_location = {
				limit = { owner = scope:target_clan }
				if = {
					limit = {
						location != location:kyoto
						location = { can_clan_get_this_location_when_turning_into_normal_tag = yes }
					}
					if = {
						limit = {
							building_type = building_type:yamashiro
							location = {
								NOR = {
									has_building = building_type:stockade 
									has_building = building_type:castle
								} 
							}
						}
						location = {
							change_building_level_in_location = {
								building = building_type:stockade
								value = 1
							}
						}
					}
					if = {
						limit = {
							building_type = building_type:shoen
						}
						location = {
							change_building_level_in_location = {
								building = building_type:market_village
								value = 1
							}
						}
					}
				}
				if = {
					limit = {
						NOR = {
							location = location:kyoto
							building_type = building_type:gosho
						}
					}
					location = { destroy_building = prev }
				}
			}
		}
	}
	reverse_add_opinion = { modifier = opinion_refused_shogunate_authority target = international_organization:japanese_shogunate.leader_country }
}

turn_japanese_clan_into_building_based = {
	custom_tooltip = {
		text = turn_japanese_clan_into_building_based.tt
		every_owned_location = {
			change_location_owner = international_organization:japanese_shogunate.leader_country
			add_core = international_organization:japanese_shogunate.leader_country
			change_building_level_in_location = {
				building = building_type:yamashiro
				value = 1
				owner = prev
			}
			change_building_level_in_location = {
				building = building_type:shoen
				value = 1
				owner = prev
			}
		}
		change_country_type = building
		if = {
			limit = { has_reform = government_reform:daimyo }
			remove_reform = government_reform:daimyo
			add_reform = government_reform:japanese_clan
		}
	}
	add_opinion = { modifier = opinion_refused_shogunate_authority target = international_organization:japanese_shogunate.leader_country }
}

#Update the game concepts when you add a new flavor title for the prime minister
add_head_of_cabinet_modifier = {
	add_country_modifier = {
		modifier = $estate$_head_of_cabinet_influence
		days = -1
		mode = add_and_extend
		desc = head_of_cabinet_influence_desc
	}
}

promote_to_head_of_cabinet_effect_base = {
	hidden_effect = {
		every_cabinet_character = {
			limit = {
				has_character_modifier = head_of_the_cabinet_modifier
			}
			remove_head_of_cabinet_effect = yes
		}
		$target$ = {
			add_character_modifier = { modifier = head_of_the_cabinet_modifier days = -1 mode = add_and_extend }
		}
	}
	$target$ = {
		if = { 		limit = { has_estate = estate_type:crown_estate }		PREV = { add_head_of_cabinet_modifier = { estate = crown_estate } }		}
		else_if = { limit = { has_estate = estate_type:nobles_estate }		PREV = { add_head_of_cabinet_modifier = { estate = nobles_estate } }	}
		else_if = { limit = { has_estate = estate_type:burghers_estate }	PREV = { add_head_of_cabinet_modifier = { estate = burghers_estate } }	}
		else_if = { limit = { has_estate = estate_type:clergy_estate }		PREV = { add_head_of_cabinet_modifier = { estate = clergy_estate } }	}
		else_if = { limit = { has_estate = estate_type:peasants_estate }	PREV = { add_head_of_cabinet_modifier = { estate = peasants_estate } }	}
		else_if = { limit = { has_estate = estate_type:dhimmi_estate }		PREV = { add_head_of_cabinet_modifier = { estate = dhimmi_estate } }	}
		else_if = { limit = { has_estate = estate_type:tribes_estate }		PREV = { add_head_of_cabinet_modifier = { estate = tribes_estate } }	}
		else_if = { limit = { has_estate = estate_type:cossacks_estate }	PREV = { add_head_of_cabinet_modifier = { estate = cossacks_estate } }	}
	}
}

promote_to_head_of_cabinet_effect = {
	custom_tooltip = promote_to_head_of_cabinet_effect_tt
	promote_to_head_of_cabinet_effect_base = { target = $target$ }
}

#Character effect called in the on_cabinet_assigned on_action
remove_head_of_cabinet_country_effect = {
	remove_country_modifier = crown_estate_head_of_cabinet_influence
	remove_country_modifier = nobles_estate_head_of_cabinet_influence
	remove_country_modifier = burghers_estate_head_of_cabinet_influence
	remove_country_modifier = clergy_estate_head_of_cabinet_influence
	remove_country_modifier = peasants_estate_head_of_cabinet_influence
	remove_country_modifier = dhimmi_estate_head_of_cabinet_influence
	remove_country_modifier = tribes_estate_head_of_cabinet_influence
	remove_country_modifier = cossacks_estate_head_of_cabinet_influence
}
remove_head_of_cabinet_effect = {
	if = {
		limit = { is_alive = yes }
		if = {
			limit = { has_character_modifier = head_of_the_cabinet_modifier }
			remove_character_modifier = head_of_the_cabinet_modifier
			owner = {
				remove_head_of_cabinet_country_effect = yes
			}
		}
	}
}

add_3_noble_privileges = {
	"estate(estate_type:nobles_estate)" = {
		random_possible_privilege = {
			save_scope_as = first_privilege
		}
		random_possible_privilege = {
			limit = {
				this != scope:first_privilege
			}
			save_scope_as = second_privilege
		}
		random_possible_privilege = {
			limit = {
				this != scope:first_privilege
				this != scope:second_privilege
			}
			save_scope_as = third_privilege
		}
	}
}

set_new_ruler_with_union_fratricide = {
	if = {
		limit = { exists = union }
		custom_description = {
			text = set_new_ruler_with_union
			object = $character$
			union ?= {
				every_international_organization_member = {
					limit = {
						succession_law = heir_selection:fratricide_succesion
					}
					#don't update the unions....yet
					set_new_foreign_ruler_no_update = $character$
				}
			}
			#now we can update the unions
			set_new_ruler = $character$
		}
	}
	else = {
		set_new_ruler = $character$
	}
}

set_new_ruler_with_union = {
	if = {
		limit = { exists = union }
		custom_description = {
			text = set_new_ruler_with_union
			object = $character$
			union ?= {
				every_international_organization_member = {
					#don't update the unions....yet
					set_new_foreign_ruler_no_update = $character$
				}
			}
			#now we can update the unions
			set_new_ruler = $character$
		}
	}
	else = {
		set_new_ruler = $character$
	}
}

#Supports the following effects:
# stability
# gold
# army_tradition
# navy_tradition
# prestige
# purity
# republican_tradition
# research_progress
# righteousness
# rite_power
# manpower
# sailors
# yearly_manpower
# yearly_sailors
add_effect_scaling_with_societal_value = {
	if = {
		limit = {
			societal_value:$societal_value$ != 0
		}
		add_$effect$ = {
			value = {
				add = societal_value:$societal_value$
				$operator$ = $value$
			}
		}
	}
}

lock_current_government_reforms = {
	custom_tooltip = {
		text = lock_current_government_reforms_tt
		set_variable = { name = has_locked_government_reforms_of_$type$ value = yes }
	}
}
lock_current_policy = {
	custom_tooltip = {
		text = lock_current_policy_tt
		set_variable = { name = has_locked_policy_of_$type$ value = yes }
	}
}
lock_current_heir_selection = {
	custom_tooltip = {
		text = lock_current_heir_selection_tt
		set_variable = { name = has_locked_heir_selection value = yes }
	}
}
lock_current_law = {
	custom_tooltip = {
		text = lock_current_law_tt
		set_variable = { name = has_locked_law_of_$type$ value = yes }
	}
}
lock_current_subject_type = {
	custom_tooltip = {
		text = lock_current_subject_type_tt
		set_variable = { name = has_locked_subject_type value = yes }
	}
}
unlock_current_government_reforms = {
	custom_tooltip = {
		text = unlock_current_government_reforms_tt
		remove_variable = has_locked_government_reforms_of_$type$
	}
}
unlock_current_policy = {
	custom_tooltip = {
		text = unlock_current_policy_tt
		remove_variable = has_locked_policy_of_$type$
	}
}
unlock_current_heir_selection = {
	custom_tooltip = {
		text = unlock_current_heir_selection_tt
		remove_variable = has_locked_heir_selection
	}
}
unlock_current_law = {
	custom_tooltip = {
		text = unlock_current_law_tt
		remove_variable = has_locked_law_of_$type$
	}
}
unlock_current_subject_type = {
	custom_tooltip = {
		text = unlock_current_subject_type_tt
		remove_variable = has_locked_subject_type
	}
}

nudge_towards_isolationism = {
	custom_tooltip = isolationism_tt
	change_societal_value = {
		type = traditionalist_vs_innovative
		value = societal_value_minor_move_to_left
	}
	change_societal_value = {
		type = individualism_vs_communalism
		value = societal_value_minor_move_to_right
	}
	if = {
		limit = {
			NOR = {
				current_age = age_1_traditions
				current_age = age_2_renaissance
			}
		}
		change_societal_value = {
			type = outward_vs_inward
			value = societal_value_minor_move_to_right
		}
	}
}

nudge_towards_openness = {
	custom_tooltip = openness_tt
	change_societal_value = {
		type = traditionalist_vs_innovative
		value = societal_value_minor_move_to_right
	}
	change_societal_value = {
		type = individualism_vs_communalism
		value = societal_value_minor_move_to_left
	}
	if = {
		limit = {
			NOR = {
				current_age = age_1_traditions
				current_age = age_2_renaissance
			}
		}
		change_societal_value = {
		type = outward_vs_inward
		value = societal_value_minor_move_to_left
	}
	}
}

add_decree_monthly_celestial_authority_loss = {
	custom_tooltip = decree_monthly_celestial_authority_loss_tt
	international_organization:middle_kingdom = {
		if = {
			limit = { has_variable = decrees_counter }
			change_variable = {
				name = decrees_counter
				add = 1
			}
		}
		else = {
			set_variable = {
				name = decrees_counter
				value = 1
			}
		}
	}
}

remove_decree_monthly_celestial_authority_loss = {
	custom_tooltip = end_decree_monthly_celestial_authority_loss_tt
	international_organization:middle_kingdom = {
		set_variable = {
			name = decrees_counter
			value = 0
		}
	}
}

create_alliance = {
	create_relation = {
		first = this
		second = $target$
		type = relation_type:alliance
	}
}

break_alliance = {
	if = {
		limit = { is_allied_with = { target = $target$ } }
		remove_relation = {
			first = this
			second = $target$
			type = relation_type:alliance
		}
	}
}

add_all_estate_satisfaction = {
	custom_description = {
		text = add_all_estate_satisfaction
		value = $value$
		if = { limit = { country_has_estate = estate_type:nobles_estate } add_estate_satisfaction = { type = estate_type:nobles_estate value = $value$ } }
		if = { limit = { country_has_estate = estate_type:clergy_estate } add_estate_satisfaction = { type = estate_type:clergy_estate value = $value$ } }
		if = { limit = { country_has_estate = estate_type:burghers_estate } add_estate_satisfaction = { type = estate_type:burghers_estate value = $value$ } }
		if = { limit = { country_has_estate = estate_type:peasants_estate } add_estate_satisfaction = { type = estate_type:peasants_estate value = $value$ } }
		if = { limit = { country_has_estate = estate_type:tribes_estate } add_estate_satisfaction = { type = estate_type:tribes_estate value = $value$ } }
		if = { limit = { country_has_estate = estate_type:dhimmi_estate } add_estate_satisfaction = { type = estate_type:dhimmi_estate value = $value$ } }
	}
}

save_ruler_regent_as_target_character = {
	if = {
		limit = { has_ruler = yes }
		ruler ?= { save_scope_as = target_character }
	}
	else = {
		regent ?= { save_scope_as = target_character }
	}
}

change_tag = {
	change_country_tag = $tag$
	hidden_effect = {
		change_country_flag = $tag$
		change_country_color = map_$tag$
		change_country_name = $tag$
		change_country_adjective = $tag$_ADJ
	}
}

change_tag_cosmetic = {
	change_country_name = $tag$
	hidden_effect = {
		change_country_flag = $tag$
		change_country_color = map_$tag$
		change_country_adjective = $tag$_ADJ
	}
}

reset_societal_value = {
	set_societal_value = { type = $type$ value = 0 }
}
reset_all_societal_values = {
	reset_societal_value = { type = centralization_vs_decentralization }
	reset_societal_value = { type = traditionalist_vs_innovative }
	reset_societal_value = { type = spiritualist_vs_humanist }
	reset_societal_value = { type = aristocracy_vs_plutocracy }
	reset_societal_value = { type = serfdom_vs_free_subjects }
	reset_societal_value = { type = mercantilism_vs_free_trade }
	reset_societal_value = { type = belligerent_vs_conciliatory }
	reset_societal_value = { type = quality_vs_quantity }
	reset_societal_value = { type = offensive_vs_defensive }
	reset_societal_value = { type = land_vs_naval }
	reset_societal_value = { type = capital_economy_vs_traditional_economy }
	reset_societal_value = { type = individualism_vs_communalism }
	reset_societal_value = { type = outward_vs_inward }
}

setup_societal_values = {
	hidden_effect = { reset_all_societal_values = yes }
	change_societal_value = { type = centralization_vs_decentralization value = $centralization_vs_decentralization$ }
	change_societal_value = { type = traditionalist_vs_innovative value = $traditionalist_vs_innovative$ }
	change_societal_value = { type = spiritualist_vs_humanist value = $spiritualist_vs_humanist$ }
	change_societal_value = { type = aristocracy_vs_plutocracy value = $aristocracy_vs_plutocracy$ }
	change_societal_value = { type = serfdom_vs_free_subjects value = $serfdom_vs_free_subjects$ }
	change_societal_value = { type = mercantilism_vs_free_trade value = $mercantilism_vs_free_trade$ }
	change_societal_value = { type = belligerent_vs_conciliatory value = $belligerent_vs_conciliatory$ }
	change_societal_value = { type = quality_vs_quantity value = $quality_vs_quantity$ }
	change_societal_value = { type = offensive_vs_defensive value = $offensive_vs_defensive$ }
	change_societal_value = { type = land_vs_naval value = $land_vs_naval$ }
	change_societal_value = { type = capital_economy_vs_traditional_economy value = $capital_economy_vs_traditional_economy$ }
	change_societal_value = { type = individualism_vs_communalism value = $individualism_vs_communalism$ }
	change_societal_value = { type = outward_vs_inward value = $outward_vs_inward$ }
}

apply_societal_value_push_modifiers = {
	custom_description = {
		text = apply_societal_value_push_modifiers
		object = $country$
		value = $years$
		if = { limit = { $country$ = { societal_value:centralization_vs_decentralization > 0 } }
			add_country_modifier = { modifier = societal_value_push_centralization years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_decentralization years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:traditionalist_vs_innovative > 0 } }
			add_country_modifier = { modifier = societal_value_push_traditionalist years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_innovative years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:spiritualist_vs_humanist > 0 } }
			add_country_modifier = { modifier = societal_value_push_spiritualist years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_humanist years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:aristocracy_vs_plutocracy > 0 } }
			add_country_modifier = { modifier = societal_value_push_aristocracy years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_plutocracy years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:serfdom_vs_free_subjects > 0 } }
			add_country_modifier = { modifier = societal_value_push_serfdom years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_free_subjects years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:mercantilism_vs_free_trade > 0 } }
			add_country_modifier = { modifier = societal_value_push_mercantilism years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_free_trade years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:belligerent_vs_conciliatory > 0 } }
			add_country_modifier = { modifier = societal_value_push_belligerent years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_conciliatory years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:quality_vs_quantity > 0 } }
			add_country_modifier = { modifier = societal_value_push_quality years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_quantity years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:offensive_vs_defensive > 0 } }
			add_country_modifier = { modifier = societal_value_push_offensive years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_defensive years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:land_vs_naval > 0 } }
			add_country_modifier = { modifier = societal_value_push_land years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_naval years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:capital_economy_vs_traditional_economy > 0 } }
			add_country_modifier = { modifier = societal_value_push_capital_economy years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_traditional_economy years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:individualism_vs_communalism > 0 } }
			add_country_modifier = { modifier = societal_value_push_individualism years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_communalism years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:outward_vs_inward > 0 } }
			add_country_modifier = { modifier = societal_value_push_outward years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_inward years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:sinicized_vs_unsinicized > 0 } }
			add_country_modifier = { modifier = societal_value_push_sinicized years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_unsinicized years = $years$ size = $size$ }
		}
		if = { limit = { $country$ = { societal_value:absolutism_vs_liberalism > 0 } }
			add_country_modifier = { modifier = societal_value_push_absolutism years = $years$ size = $size$ }
		}
		else = {
			add_country_modifier = { modifier = societal_value_push_liberalism years = $years$ size = $size$ }
		}
	}
}

set_ended_disaster_flag_effect = {
	if = {
		limit = { NOT = { has_variable = had_$type$_disaster } }
		set_variable = {
			name = had_$type$_disaster
			value = 1
		}
	}
	else = {
		change_variable = {
			name = had_$type$_disaster
			add = 1
		}
	}
}

make_regent_to_ruler = {
	if = {
		limit = { has_regent = yes }
		regent ?= {
			if = {
				limit = { NOT = { has_estate = estate_type:nobles_estate } }
				change_character_estate = estate_type:nobles_estate
			}
			if = {
				limit  = { 
					has_dynasty = no
					exists = location.owner
				}
				custom_tooltip = regencies.1.founds_dynasty_tt
				hidden_effect = {
					location = { 
						create_dynasty_from_location = random
						last_dynasty_in_location = { save_scope_as = target_dynasty }
					}
					change_dynasty = scope:target_dynasty
				}
			}
			every_descendant = {
				if = {
					limit = { 
						NOR = { 
							has_estate = estate_type:nobles_estate 
							has_estate = estate_type:clergy_estate 
						}
					}
					change_character_estate = estate_type:nobles_estate
				}
				hidden_effect = {
					if = {
						limit = { has_dynasty = no }
						change_dynasty = scope:target_dynasty
					}
				}
			}
		}
		if = {
			limit = {
				regent.religion.group != religion.group
			}
			change_religion = regent.religion
		}
		set_new_ruler = regent
	}
}

set_country_rank_effect = {
	if = {
		limit = {
			OR = {
				AND = {
					country_rank_level < 2
					$rank$ = country_rank:rank_duchy
				}
				AND = {
					country_rank_level < 3
					$rank$ = country_rank:rank_kingdom
				}
				AND = {
					country_rank_level < 4
					$rank$ = country_rank:rank_empire
				}
			}
		}
		set_country_rank = $rank$
	}
}

set_character_as_the_great = {
	$target$ = {
		set_nickname = nick_the_great
		add_character_modifier = {
			modifier = the_great_ruler_modifier
			years = -1
			mode = add_and_extend
		}
	}
	add_prestige = prestige_severe_bonus
	hidden_effect = {
		set_variable = { name = dynamic_the_great_character value = $target$ }
	}
}

make_the_great_scope = {
	if = {
		limit = { has_or_had_great_ruler = yes }
		var:dynamic_the_great_character = { save_scope_as = $save_scope_as$ }
	}
}

add_historical_rival_scripted = {
	if = {
		limit = {
			exists = $target$
			NOT = { this = $target$ }
		}
		add_historical_rival = $target$
		if = {
			limit = { NOT = { is_rival_of = $target$ } }
			add_rival = $target$
		}
		if = {
			limit = { country_exists = $target$ }
			if = {
				limit = { is_allied_with = { target = $target$ } }
				break_alliance = { target = $target$ }
			}
		}
		hidden_effect = {
			set_local_variable = { name = trigger_recipient_event value = $trigger_recipient_event$ }	#Yes/no
			if = {
				limit = { local_var:trigger_recipient_event = yes }
				save_scope_as = rivalling_country
				$target$ = { trigger_event_silently = historical_rival_events.1 }
			}
		}
	}
}

remove_historical_rival_scripted = {
	if = {
		limit = {
			exists = $target$
			NOT = { this = $target$ }
			has_historical_rival = $target$
		}
		remove_historical_rival = $target$
		if = {
			limit = { country_exists = $target$ }
			hidden_effect = {
				set_local_variable = { name = trigger_recipient_event value = $trigger_recipient_event$ }	#Yes/no
				if = {
					limit = { local_var:trigger_recipient_event = yes }
					save_scope_as = rivalling_country
					$target$ = { trigger_event_silently = historical_rival_events.2 }
				}
			}
		}
	}
}

chi_adjust_pre_rtr_modifiers = {
	if = {
		limit = {
			current_date < 1368.1.1
			situation:red_turban_rebellions = {
				situation_is_active = no
				situation_has_ended = no
			}
		}
		custom_description = {
			text = chi_adjust_pre_rtr_modifiers_text
			value = $value$
			if = {
				limit = { NOT = { has_variable = chi_rtr_modifier_intensity } }
				set_variable = {
					name = chi_rtr_modifier_intensity
					value = {
						value = 1
						add = $value$
					}
				}
			}
			else = {
				change_variable = {
					name = chi_rtr_modifier_intensity
					add = $value$
				}
			}
			if = {
				limit = {
					has_variable = chi_rtr_modifier_intensity
					var:chi_rtr_modifier_intensity > 0
				}
				add_country_modifier = {
					modifier = chi_factional_strife
					months = {
						value = 1368
						add = 1
						subtract = current_year
						multiply = 12
					}
					mode = replace
					size = var:chi_rtr_modifier_intensity
				}
			}
			else = {
				remove_country_modifier = chi_factional_strife
			}
		}
		custom_tooltip = chi_adjust_pre_rtr_modifiers_base_text
	}
}

move_capital_event_effect = {
	set_capital = $to$

	show_as_tooltip = {
		$to$ = {
			change_development = {
				value = $from$.development
				subtract = $to$.development
				min = 0
				multiply = 0.75
			}
		}
		$from$ = {
			change_development = {
				value = $from$.development
				subtract = $to$.development
				min = 0
				multiply = -0.75
			}
		}
	}

	hidden_effect = {
		set_local_variable = {
			name = difference_between_targets
			value = {
				value = $from$.development
				subtract = $to$.development
				min = 0
				multiply = 0.75
			}
		}

		$to$ = {
			change_development = local_var:difference_between_targets
		}

		$from$ = {
			change_development = {
				value = local_var:difference_between_targets
				multiply = -1
			}
		}
	}

	$to$ = {
		if = {
			limit = { location_rank = location_rank:city }
			province = {
				every_location_in_province = { change_prosperity = prosperity_mild_bonus }
			}
		}
		else_if = {
			limit = { location_rank = location_rank:town }
			change_location_rank = location_rank:city
		}
		else = {
			change_location_rank = location_rank:town
		}
	}

	add_migration = {
		owner = this
		from_location = $from$
		to_location = $to$
		culture = root.culture
		amount = {
			fixed_range = {
				min = {
					value = $from$.population
					divide = 100
				}
				max = {
					value = $from$.population
					multiply = 2
					divide = 100
				}
			}
		}
		months = 6
	}
}

enable_treasure_voyages = {
	custom_tooltip = {
		text = chi_able_to_send_treasure_voyages
		set_variable = enabled_treasure_voyages

		#pre-construct a list of areas we can voyage to
		if = {
			limit = {
				not = { has_global_variable_list = treasure_voyage_areas }
			}
			every_area = {
				limit = {
					is_area_coastal_sea = yes
					OR = {
						sub_continent = sub_continent:south_east_asia
						sub_continent = sub_continent:east_africa
						sub_continent = sub_continent:south_asia
						sub_continent = sub_continent:middle_east
					}
					NOR = {
						region = region:anatolia_region
						region = region:crescent_region
					}
				}
				add_to_global_variable_list = {
					name = treasure_voyage_areas
					target = this
				}
			}
		}
	}
}

disable_treasure_voyages = {
	custom_tooltip = {
		text = chi_unable_to_send_treasure_voyages
		remove_variable = enabled_treasure_voyages
		clear_global_variable_list = treasure_voyage_areas
	}
}

chinese_treasure_sail_to = {

	$to$ = { save_scope_as = next_tile } # Necessary for the variable calculation and for the next event in line to know where the fleet's location is supposed to be set to

	set_local_variable = {
		name = time_to_travel
		value = {
			value = "scope:next_tile.distance_to(scope:expedition_initiator.var:chinese_treasure_fleet_location)"
			divide = 5
			multiply = { # Leader's military skill can speed up the expedition travel time greatly
				value = 1
				subtract = {
					value = scope:target_character.mil
					divide = 100
					multiply = 0.5
				}
			}
			min = 1
		}
	}
	trigger_event_silently = {
		id = flavor_chi.2003
		days = local_var:time_to_travel
	}
}

chinese_treasure_depart_from_port = {
	custom_tooltip = chi_fleet_will_depart
	
	grant_effects_of_opinion = yes

	scope:expedition_initiator ?= {
		trigger_event_silently = flavor_chi.2003
	}
}

chinese_expedition_calculate_gift_for_this = {
	set_variable = {
		name = gift_value
		value = {
			value = total_population
			divide = 1000
			multiply = { #multiply by 0.5 to 1.5
				value = 1
				add = {
					value = chinese_expedition_scoring_function
					multiply = -1
				}
				add = 0.5
				multiply = 10
			}
			max = scope:expedition_initiator.var:chinese_treasure_voyage_cargo
		}
	}
}

chi_expedition_resolution_very_positive = {
	add_country_modifier = {
		mode = replace
		modifier = chi_beloved_by_expedition
		years = 25
	}
	if = {
		limit = {
			exists = international_organization:middle_kingdom
			NOT = { is_member_of_international_organization = international_organization:middle_kingdom }
		}
		international_organization:middle_kingdom = {
			add_country_to_international_organization = ROOT
		}
		scope:expedition_initiator = {
			add_to_variable_list = {
				name = nations_to_make_tributary
				target = root
			}
		}
	}
	
}

chi_expedition_resolution_positive = {
	add_country_modifier = {
		mode = replace
		modifier = chi_favored_by_expedition
		years = 25
	}
	if = {
		limit = {
			exists = international_organization:middle_kingdom
			NOT = { is_member_of_international_organization = international_organization:middle_kingdom }
		}
		international_organization:middle_kingdom = {
			add_country_to_international_organization = ROOT
		}
		scope:expedition_initiator = {
			add_to_variable_list = {
				name = nations_to_make_tributary
				target = root
			}
		}
	}
}

chi_expedition_resolution_negative = {
	add_country_modifier = {
		mode = replace
		modifier = chi_resisting_subjugation
		years = 25
	}
}

chi_expedition_resolution_very_negative = {
	add_country_modifier = {
		mode = replace
		modifier = chi_arrogant_attitude_towards_expedition
		years = 25
	}
}

change_opinion_of_expedition = {
	custom_description = {
		text = change_opinion_of_expedition
		value = $value$
		change_variable = {
			name = chinese_expedition_opinion
			add = $value$
		}

		if = {
			limit = {
				var:chinese_expedition_opinion >= 100
			}
			set_variable = {
				name = chinese_expedition_opinion
				value = 100
			}
		}
		else_if = {
			limit = {
				var:chinese_expedition_opinion <= -100
			}
			set_variable = {
				name = chinese_expedition_opinion
				value = -100
			}
		}
	}
}

increase_opinion_of_expedition = {
	change_opinion_of_expedition = {
		value = 20
	}
}

increase_opinion_of_expedition_greatly = { 
	change_opinion_of_expedition = {
		value = 50
	}
}

decrease_opinion_of_expedition = {
	change_opinion_of_expedition = {
		value = -20
	}
}

decrease_opinion_of_expedition_greatly = {
	change_opinion_of_expedition = {
		value = -50
	}
}

grant_effects_of_opinion = {
	custom_tooltip = based_on_expedition_opinion
	if = {
		limit = {
			var:chinese_expedition_opinion >= 67
		}
		chi_expedition_resolution_very_positive = yes
	}
	else_if = {
		limit = {
			var:chinese_expedition_opinion >= 33
		}
		chi_expedition_resolution_positive = yes
	}
	else_if = {
		limit = {
			var:chinese_expedition_opinion <= -33
		}
		chi_expedition_resolution_negative = yes
	}
	else_if = {
		limit = {
			var:chinese_expedition_opinion <= -67
		}
		chi_expedition_resolution_very_negative = yes
	}
	else = {
		custom_tooltip = custom_tooltip_generic_nothing_happens
	}
	remove_variable = chinese_expedition_opinion
	remove_variable = being_visited_by_expedition_from
}

ignore_succesion_effect = {
	hidden_effect = {
		if = {
			limit = { succession_law = heir_selection:partition_inheritance }
			set_variable = {
				name = ignore_succesion_effect
				days = 5
			}
		}
	}
}

select_insignificant_gov_reform = {
	if = {
		limit = { num_open_reform_slots = 0 }
		random_current_reforms = {
			limit = {
				is_unique_reform = no
				is_major_reform = no
			}
			save_scope_as = $save_scope_as$
		}
		random_current_reforms = {
			limit = {
				is_unique_reform = no
				is_major_reform = no
				NOT = { is_fully_implemented_in = PREV }
			}
			save_scope_as = $save_scope_as$
		}
	}
}

add_replacing_gov_reform = {
	select_insignificant_gov_reform = {
		save_scope_as = target_reform
	}
	if = {
		limit = { exists = scope:target_reform }
		remove_reform = scope:target_reform
	}
	add_reform = $reform$
}

set_government_name = { hidden_effect = { set_variable = $key$_government_name } }
clr_government_name = { hidden_effect = { remove_variable = $key$_government_name } }

add_character_to_random_open_cabinet = {
	random_cabinet = {
		limit = {
			NOT = { 
				exists = cabinet_member
			}
		}
		add_to_cabinet = $target$
	}
}

yua_appoint_as_dictator = {
	add_country_modifier = {
		mode = replace
		modifier = yua_dictator_powers
		years = 30 
	}
	add_character_to_random_open_cabinet = {
		target = $target$
	}
	promote_to_head_of_cabinet_effect_base = {
		target = $target$
	}
}

break_union = {
	custom_description = {
		text = break_union_text
		object = $target$
		save_scope_as = root_country
		if = {
			limit = { has_variable = pu_war_senior_partner }
			remove_variable = pu_war_senior_partner
		}
		if = {
			limit = { in_union_with = $target$ }
			union = {
				remove_country_from_international_organization = scope:root_country
			}
		}
		if = {
			limit = {
				OR = {
					has_ruler = no
					ruler = {
						NOT = { owner = scope:root_country }
					}
				}
			}
			if = {
				limit = { has_ruler = yes }
				ruler = { save_scope_as = target_character }
			}
			if = {
				limit = { NOT = { exists = scope:target_character } }
				ordered_character = {
					order_by = heir_score_home
					limit = { is_adult = yes }
					max = 1
					check_range_bounds = no
					save_scope_as = target_character
				}
			}
			if = {
				limit = { NOT = { exists = scope:target_character } }
				create_character = {
					estate = estate_type:nobles_estate
					adm = { 20 60 }
					dip = { 20 60 }
					mil = { 50 90 }
					age = 35
					female = no
					save_scope_as = target_character
				}
			}
			if = {
				limit = { exists = scope:target_character }
				set_new_ruler = scope:target_character
			}
		}
	}
}

add_to_revolutionary_list = {
	hidden_effect = {
		add_to_global_variable_list = {
			name = revolutionary_countries
			target = this
		}
	}
}

remove_from_revolutionary_list = {
	hidden_effect = {
		remove_list_global_variable = {
			name = revolutionary_countries
			target = this
		}
	}
}

set_revolution_effect = {
	set_revolution = yes
	hidden_effect = {
		#Set the government currencies up
		add_government_power = -100
		add_government_power = 50
		add_stability = -200
		add_stability = 115
		add_prestige = -100
		add_prestige = 20
		create_character = {
			estate = estate_type:burghers_estate
			adm = { 50 90 }
			dip = { 50 90 }
			mil = { 50 90 }
			save_scope_as = rev_ruler
		}
		set_new_ruler = scope:rev_ruler
		set_societal_value = { value = 50 type = traditionalist_vs_innovative }
		set_societal_value = { value = 25 type = aristocracy_vs_plutocracy }
		set_societal_value = { value = 75 type = spiritualist_vs_humanist }
		set_societal_value = { value = 100 type = serfdom_vs_free_subjects }
		set_societal_value = { value = -33 type = belligerent_vs_conciliatory }
		set_societal_value = { value = -50 type = individualism_vs_communalism }
		add_gold = 5000
		add_manpower = 50
		save_scope_as = rev_country_scope
		every_estate_privilege = {
			scope:rev_country_scope = {
				revoke_estate_privilege = PREV
			}
		}
		add_all_estate_satisfaction = { value = estate_satisfaction_extreme_bonus }
		start_parliament_effect = yes
		add_army_tradition = army_tradition_radical_bonus
		add_navy_tradition = navy_tradition_radical_bonus
		while = {
			count = 8
			create_character = {
				adm = { 50 70 }
				dip = { 50 70 }
				mil = { 50 70 }
			}
		}
	}
}

remove_revolution = {
	set_revolution = no
	hidden_effect = {
		remove_from_revolutionary_list = yes
	}
	change_government_type = government_type:monarchy
	ruler_or_regent ?= {
		if = {
			limit = { has_dynasty = no }
			found_dynasty = random
		}
		if = {
			limit = { NOT = { has_estate = estate_type:nobles_estate } }
			change_character_estate = estate_type:nobles_estate
		}
		hidden_effect = {
			every_descendant = {
				limit = { 
					NOR = { 
						has_estate = estate_type:nobles_estate 
						has_estate = estate_type:clergy_estate 
					}
				}
				change_character_estate = estate_type:nobles_estate
				hidden_effect = {
					if = {
						limit = { has_dynasty = no }
						change_dynasty = prev.dynasty
					}
				}
			}
		}
		if = {
			limit = { PREV = { has_regent = yes } }
			PREV = { set_new_ruler = PREV }
		}
	}
}

set_revolution_target_effect = {
	set_revolution_target = yes
	hidden_effect = {
		if = {
			limit = { is_revolutionary = no }
			set_revolution_effect = yes
		}
		capital ?= {
			while =  {
				count = 2
				create_sub_unit_of_category = sub_unit_category:army_infantry
			}
			while =  {
				count = 1
				create_sub_unit_of_category = sub_unit_category:army_cavalry
			}
			while =  {
				count = 1
				create_sub_unit_of_category = sub_unit_category:army_artillery
				create_sub_unit_of_category = sub_unit_category:army_auxiliary
			}
		}
	}
}

start_parliament_effect = {
	if = {
		limit = { is_active_parliament = no }
		if = {
			limit = { exists = scope:parliament_location }
			set_parliament_location = scope:parliament_location
			custom_tooltip = select_parliament_location_modifier_tooltip
			if = {
				limit = { scope:parliament_location = capital }
				custom_tooltip = select_parliament_location_capital_modifier_tooltip
			}
			else = {
				custom_tooltip = select_parliament_location_not_capital_modifier_tooltip
			}
		}
		else_if = {
			limit = { exists = capital }
			set_parliament_location = capital
		}
		set_parliament_active = yes
		if = {
			limit = { NOT = { exists = scope:parliament_issue } }
			random_possible_parliament_issue = { save_scope_as = parliament_issue }
		}
		if = {
			limit = { exists = scope:parliament_issue }
			set_parliament_issue = scope:parliament_issue
			set_parliament_issue_support = {
				add = { desc = parliament_base_support value = modifier:parliament_base_support }
				if = {
					limit = { scope:parliament_issue.estate_type = { always_loyal = no } }
					add = { desc = estate_power value = "estate_power(scope:parliament_issue.estate_type)" }
				}
			}
		}
	}
}

create_union_of_integration_level = {
	if = {
		limit = {
			NOT = { in_union_with = $target$ }
			$target$ = { NOT = { exists = union } }
		}
		custom_description = {
			text = create_union_of_integration_level
			object = $target$
			value = $level$
			if = {
				limit = { exists = union }
				union ?= {
					if = {
						limit = { modifier:union_integration_level > 0 }
						save_temporary_scope_value_as = {
							name = applied_level
							value = $level$
						}
						save_temporary_scope_value_as = {
							name = current_level
							value = modifier:union_integration_level
						}
						if = {
							limit = { scope:applied_level > scope:current_level }
							save_temporary_scope_value_as = {
								name = applied_level
								value = scope:current_level
							}
						}
					}
					save_temporary_scope_as = temp_target_union
				}
				create_union = $target$
				if = {
					limit = {
						exists = scope:applied_level
						exists = scope:temp_target_union
					}
					$target$ = {
						set_individual_integration_level = {
							value = scope:applied_level
							international_organization = scope:temp_target_union
						}
					}
				}
			}
			else = {
				create_union = $target$
				union ?= {
					apply_union_levels = { level = $level$ }
				}
			}
		}
	}
}

annex_country_diplomatically = { 
	show_as_tooltip = {
		annex_country = { country = $country$ reason = Diplomatic }
	}
	hidden_effect = {
		$country$ = { set_variable = no_annex_event_trigger }
		annex_country = { country = $country$ reason = Diplomatic }
		$country$ = { remove_variable = no_annex_event_trigger }
	}
}

on_bribe_default_effect = {
	if = {
		limit = {
			exists = union
			union ?= {
				modifier:union_integration_level > 0
			}
			exists = scope:recipient
		}
		if = {
			limit = { scope:recipient = { has_variable = integrated_in_union } }
			save_temporary_scope_value_as = {
				name = union_cost_factor_multiplier
				value = {
					value = union.modifier:union_integration_level
					subtract = scope:recipient.var:integrated_in_union
				}
			}
		}
		else = {
			save_temporary_scope_value_as = {
				name = union_cost_factor_multiplier
				value = union.modifier:union_integration_level
			}
		}
		if = {
			limit = {
				great_power_score > 0
			}
			save_temporary_scope_value_as = {
				name = union_special_status_multiplier
				value = {
					value = scope:recipient.great_power_score
					divide = great_power_score
					add = 1
				}
			}
		}
	}
	if = {
		limit = { exists = scope:union_cost_factor_multiplier }
		add_government_power = {
			value = government_power_weak_penalty
			multiply = scope:union_cost_factor_multiplier
			if = {
				limit = { exists = scope:union_special_status_multiplier }
				multiply = scope:union_special_status_multiplier
			}
		}
		add_gold = union_parliament_gold_bribe_actor
		scope:recipient = {
			add_gold_to_estate = {
				estate_type = scope:target
				value = union_parliament_gold_bribe_recipient
			}
		}
	}
}

change_religion_for_ruler_and_family = {
	hidden_effect = {
		$country$ = {
			if = {
				limit = {
					ruler ?= {
						owner = $country$ 
					}
				}
				heir ?= {
					if = {
						limit = {
							owner = $country$
						}
						change_character_religion = $religion$
					}
				}
				ruler ?= {
					change_character_religion = $religion$
					every_descendant = {
						limit = {
							owner = $country$
						}
						change_character_religion = $religion$
					}
					every_spouse = {
						limit = {
							owner = $country$
							this != $country$.heir
						}
						change_character_religion = $religion$
					}
				}
			}
		}
	}
}


setup_colonial_nation = {
	change_government_type = government_type:republic
	add_gold = 100
	capital.province = { change_province_integration = integrated }
	add_reform = government_reform:colonial_subject
	every_owned_location = {
		change_control = control_radical_bonus
	}
	
	add_country_modifier = {
		modifier = new_colonial_nation_founded
		years = 50
		mode = add_and_extend
	}
}

cc_setup_new_town = {
	change_building_level_in_location = { building = building_type:clay_pit		value = 1 }
	change_building_level_in_location = { building = building_type:lumber_mill	value = 1 }
	change_building_level_in_location = { building = building_type:mason		value = 1 }
	change_max_raw_material_workers = 1
	
	if = {
		limit = { market_access <= 0 }
	
		create_market = {
			builder = root
			location = scope:new_town
			price = price:create_market
			instant = yes
			price_modifier = 0
		}	
	}
}
