war_of_the_roses = {

	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	monthly_spawn_chance = monthly_spawn_chance_very_high

	fire_only_once = yes

	can_start = {
		tag = ENG
		current_year > 1430
		current_year < 1500
		
		owns = location:york
		owns = location:lancaster
		
		exists = dynasty:york_dynasty
		exists = dynasty:lancaster_dynasty
		
		
		dynasty:york_dynasty ?= {
			dynasty_head ?= {
				is_adult = yes
			}
		}
		dynasty:lancaster_dynasty ?= {
			dynasty_head ?= {
				is_adult = yes
			}
		}
	
		ruler ?= {
			fertility <= 0
			is_adult = yes
			num_of_children = 0
			OR = {
				is_married = no
				first_spouse = { is_pregnant = no }
			} 
			dynasty = dynasty:plantagenet_dynasty
		}
	}
	

	can_end = {
		war_of_the_roses_end_trigger = yes
	}
	modifier = {
		global_mercenaries_modifier = 0.25
		monthly_legitimacy = -0.2
	}
	
	on_start = {
		trigger_event_silently = war_of_the_roses.1
		
		dynasty:lancaster_dynasty = {
			dynasty_head ?= {
				rebel = {
					save_scope_as = lancaster_rebel
				}
			}
		}
		
		dynasty:york_dynasty = {
			dynasty_head ?= {
				rebel = {
					save_scope_as = york_rebel
				}
			}
		}

		set_variable = { name = has_had_war_of_the_roses_disaster value = 1 }

	}
	on_end = {
		trigger_event_silently = war_of_the_roses.100
	}
	
	on_monthly = {
		
	
		if = {
			limit = {
				has_variable = supports_house_of_lancaster
				NOT = { 
					dynasty:york_dynasty ?= {
						dynasty_head ?= {
							is_adult = yes
						}
					}
				}
			}
			destroy_rebel = scope:york_rebel
		}

		if = {
			limit = {
				has_variable = supports_house_of_york
				NOT = { 
					dynasty:lancaster_dynasty ?= {
						dynasty_head ?= {
							is_adult = yes
						}
					}
				}
			}
			destroy_rebel = scope:lancaster_rebel
		}

	
		random_list = {
			25 = { custom_tooltip = an_event_occurs_tt }
			75 = { custom_tooltip = no_event_occurs_tt }
		}
		hidden_effect = {
			random_list = {
				100 = { trigger_event_silently = war_of_the_roses.2 }
				300 = { 
					custom_tooltip = {
						text = wotr_support_for_pretenders
						trigger_event_silently = war_of_the_roses.3 
						trigger_event_silently = war_of_the_roses.4
					}
				}
				100 = { 
					custom_tooltip = {
						text = wotr_support_for_pretender_deeepens
						trigger_event_silently = war_of_the_roses.15
						trigger_event_silently = war_of_the_roses.16
					}
				}
				100 = { trigger_event_silently = war_of_the_roses.5 }
				100 = { trigger_event_silently = war_of_the_roses.6 }
				100 = { trigger_event_silently = war_of_the_roses.8 }
				100 = { trigger_event_silently = war_of_the_roses.9 }



				100 = {
					custom_tooltip = {
						text = wotr_foreign_power_intervenes
						random_country = {
							limit = {
								capital.sub_continent = root.capital.sub_continent
								OR = {
									country_rank = country_rank:rank_kingdom
									country_rank = country_rank:rank_empire
									is_neighbor_of = root
								}
								NOT = { has_variable = supports_house_of_york }
								NOT = { has_variable = supports_house_of_lancaster }
								is_during_bankruptcy = no
							}
							
							if = {
								limit = {
									root = { 
										has_variable = supports_house_of_york 
										exists = scope:lancaster_rebel
									}
								}
								trigger_event_silently = war_of_the_roses.12
							}
							if = {
								limit = {
									root = { 
										has_variable = supports_house_of_lancaster 
										exists = scope:york_rebel
									}
								}
								trigger_event_silently = war_of_the_roses.13
							}
						}

					}
				}
			}		
		}
		trigger_event_silently = war_of_the_roses.18
	}
}