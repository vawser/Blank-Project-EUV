middle_kingdom = {
	has_target = no
	unique = yes
	show_on_diplomatic_map = yes
	expel_members_who_are_targets_of_other_members = no
	land_ownership_rule = middle_kingdom_land_ownership
	antagonism_modifier_for_taking_land_from_fellow_member = 0.5
	has_leader_country = yes
	leader_type = country

	leader_color = define:NMapColors|INTERNATIONAL_ORGANIZATION_LEADER_COLOR
	#member_color = rgb { 46 139 87 }

	leader_title_key = "EMPEROR_CHINA"
	title_is_suffix = yes
	override_ruler_title = yes
	leader_type = character
	leader = {
		leader_country ?= {
			if = {
				limit = { 
					has_regent = yes 
					has_heir = yes
				}
				heir = {
					add_to_list = leaders
				}
			}
			else = {
				ruler = {
					add_to_list = leaders
				}
			}
		}
	}
	
	#By recognizing the Emperor of China as the overlord, no one can match its position.
	modifier = {
		block_from_change_to_empire_rank = yes
		monthly_towards_sinicized = societal_value_monthly_move
	}

	#If any Tributary is attacked, the Emperor gets the option to join.
	only_leader_country_joins_defensive_wars = yes
	join_defensive_wars_auto_call = {
		scope:target ?= {
			NOT = {
				is_member_of_international_organization = root
			}
		}
	}
	
	create_visible_trigger = {
		always = no
	}

	invite_visible_trigger = {
		always = yes
	}

	#Members and even the Emperor can attack the others.
	can_declare_war = {
		always = yes
	}

	#Being the Emperor of China is prestigious.
	leader_modifier = {
		great_power_score_exempt_from_forfeit = 50
		cultures_capacity = 50
		diplomatic_capacity_modifier = 0.5
		allow_tributary_subject = yes
	}
	
	can_lead_trigger = {
		is_leader_of_international_organization = international_organization:middle_kingdom
	}
	
	can_join_trigger = {
		at_war = no
		OR = {
			is_subject_of = scope:recipient.leader_country
			is_subject = no
		}
		NOT = { country_rank = country_rank:rank_empire }
		trigger_if = {
			limit = {
				exists = international_organization:japanese_shogunate
				is_member_of_international_organization = international_organization:japanese_shogunate
			}
			is_leader_of_international_organization = international_organization:japanese_shogunate
		}
		OR = {
			capital ?= { continent = continent:asia }
			culture = {
				OR = {
					has_culture_group = culture_group:chinese_group
					has_culture_group = culture_group:confucian_group
				}
			}
			religion = {
				OR = {
					group = religion_group:folk_asian_group
					group = religion_group:buddhist
				}
			}
		}
	}
	
	can_leave_trigger = {
		NOT = { is_subject_of = scope:recipient.leader_country }
		NOT = { is_leader_of_international_organization = scope:recipient }
	}
	
	auto_leave_trigger = {
		NOT = { is_leader_of_international_organization = scope:recipient }
		is_at_war_with = scope:recipient.leader_country
	}
	
	auto_disband_trigger = {
		always = no
	}

	on_joined = {
		if = {
			limit = { 
				scope:recipient.leader_country != root
			}
			create_relation = { 
				first = scope:recipient.leader_country
				second = root
				type = relation_type:exclusive_trade_rights_with_isolated
			}
		}
	}

	on_left = {
		if = {
			limit = {
				exists = scope:recipient.leader_country
				scope:recipient.leader_country != root
			}
			remove_relation = { 
				first = scope:recipient.leader_country
				second = root
				type = relation_type:exclusive_trade_rights_with_isolated
			}
		}
	}
	
	monthly_effect = {
		#auto-join anyone who becomes subject or tributary of China
		leader_country ?= {
			every_subject = {
				limit = { NOT = { is_member_of_international_organization = root } }
				root = {
					add_country_to_international_organization = prev
				}
			}				
		}
	}
	
	variables = {
		num_of_celestial_governors = {
			min = 0
			max = 4
			start = 1
			monthly_change_hidden = yes
		}
		celestial_authority = {
			format = "celestial_authority_DISPLAY"
			change_format = "VARIABLE_CHANGE_FORMAT"
			min = 0
			max = 100
			start = 70
			monthly_change = {
				subtract = {
					desc = "BASE_DECAY"
					value = 0.1
				}
				add = {	
					#internal wars
					if = {
						limit = {
							any_international_organization_member = {
								any_country_at_war_with = {
									is_member_of_international_organization = root 
								}
							}
						}
						add = {
							desc = "MIDDLE_KINGDOM_MEMBERS_AT_WAR"
							value = 0
							every_international_organization_member = {
								limit = {
									any_country_at_war_with = {
										is_member_of_international_organization = root 
									}
								}
								add = -0.01
							}
						}
					}
					#Number of Tributaries
					add = {
						desc = "NUMBER_OF_TRIBUTARIES"
						value = 0
						every_international_organization_member = {
							limit = {
								root = {
									NOT = {
										country_has_special_status = {
											type = special_status:celestial_governor
											country = prev
										}
									}
								}
								NOT = { is_leader_of_international_organization = root }
							}
							add = {
								value = 0.005
								if = {
									limit = { exists = root.leader_country }
									multiply = {
										value = "opinion(root.leader_country)"
										divide = 200
									}
								}
								multiply = {
									value = great_power_score
									divide = 100
								}
							}
						}
					}
				}
				if = {
					limit = { has_variable = decrees_counter }
					subtract = {
						desc = "ACTIVE_DECREES"
						value = {
							add = 0.1
							multiply = var:decrees_counter
						}
					}
				}
				if = {
					limit = { 
						NOT = { 
							leader_country = { modifier:monthly_celestial_authority = 0 }
						}
					}
					add = {
						desc = "IO_MONTHLY_CELESTIAL_AUTHORITY"
						#value = 0
						value = leader_country.modifier:monthly_celestial_authority
					}
				}
			}
		}
	}

	payments_implemented = {
		middle_kingdom_tribute
	}

	special_statuses_implemented = {
		celestial_governor
	}

	ai_desire_to_join = {
		add = {
			desc = "OPINION_OF_CHINESE_EMPEROR"
			value = {
				scope:recipient = {
					leader_country = {
						root = {
							value = this_opinion_of_prev
							multiply = 0.2
						}
					}
				}
			}
		}
		if = {
			limit = {
				opinion = {
					target = scope:recipient.leader_country
					value < -20
				}
			}
			add = {
				desc = "POOR_RELATIONS"
				value = -1000
			}
		}
		add = {
			desc = "EMPEROR_DIP_REPUTATION"
			scope:recipient = {
				value = leader_country.modifier:diplomatic_reputation
				multiply = 2
			}
		}
		if = {
			limit = {
				NOT = { within_diplomatic_range = scope:recipient.leader_country }
			}
			add = {
				desc = "OUTSIDE_OF_DIP_RANGE"
				value = -1000
			}
		}
		add = {
			desc = "DISTANCE_FROM_CHINA"
			value = "border_distance_to(scope:recipient.leader_country)"
			multiply = -0.05
			min = -1000
		}
		if = {
			limit = { at_war = yes }
			add = {
				desc = "IS_AT_WAR"
				value = -1000
			}
		}
	}
	
	ai_desire_to_allow_new_member = {
		add = {
			desc = "WE_WANT_THE_ORGANIZATION_TO_GROW"
			value = 20
		}
		if = {
			limit = {
				leader_country = { is_during_bankruptcy = yes }
			}
			add = {
				desc = "WE_EXPERIENCE_BANKRUPTCY"
				value = -1000
			}
		}
		add = {
			desc = "CURRENT_CELESTIAL_AUTHORITY"
			root = { 
				value = var:celestial_authority 
				multiply = 0.05
			}
		}
		scope:actor = {
			add = {
				desc = "ECONOMIC_SIZE"
				value = monthly_income_trade_and_tax
				multiply = -1
			}
			if = {
				limit = {
					is_subject_of = root.leader_country
				}
				add = {
					desc = "NOT_SUBJECT_OF_EMPEROR"
					value = -25
				}
			}
		}
	}
}
