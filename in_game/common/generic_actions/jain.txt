# scope:actor = country, scope:recipient = religion
pilgrimage_jain = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:jain
	}

	allow = {
		scope:actor = { 
			has_ruler = yes
			ruler = {
				NOT = { has_character_modifier = character_on_pilgrimage }
			}
		}
	}
	
	price = price:pilgrimage_jain
	
	#scope:actor is the country doing the action, scope:target is the holy site
	price_modifier = {
		add = 1
		add = {
			if = {
				limit = {
					exists = scope:target
				}
				scope:target.location.owner = {
					value = scope:actor.prev_opinion_of_this
					divide = -400
				}
			}
		}
	}

	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	select_trigger = {
		looking_for_a = holy_site
		source = recipient
		target_flag = target
		name = "pilgrimage_select_holy_site_title"
		none_available_msg_key = "pilgrimage_no_holy_sites"
		column = {
			data = name
		}
		allow_null = yes
		enabled = {
			location = {
				has_owner = yes
				OR = {
					owner = scope:actor
					owner = {
						OR = {
							is_allied_with = { target = scope:actor }
							"opinion(scope:actor)" > 50
						}
					}
				}
			}
		}
	}
	
	effect = {
		if = {
			limit = { exists = scope:target }
			scope:actor ?= {
				add_karma = karma_mild_bonus
				ruler ?= {
					add_character_modifier = { 
						modifier = character_on_pilgrimage
						months = 12
						mode = add_and_extend
					}
					hidden_effect = {
						set_variable = {
							name = pilgrimage_holy_site
							value = scope:target
							months = 12
						}
					}
				}
			}
		}
	}


	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines
	ai_will_do = {
		add = "scope:actor.currency_utility(karma|10)"
	}
}
