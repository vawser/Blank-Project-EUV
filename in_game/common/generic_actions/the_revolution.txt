institute_governmental_purges = {
	type = situation
	show_message = no 
	potential = { }

	allow = {
		
	}
	
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	price = price:revolution_actions_price

	cooldown = {
		type = institute_governmental_purges_key
		years = 1
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		source = actor
		looking_for_a = character
		target_flag = target_character
		name = "choose_character"
		none_available_msg_key = "no_characters_available"
		column = { data = name }
		visible = {
			is_ruler = no
		}
	}
	effect = { 
		if = {
			limit = { exists = scope:target_character }
			scope:actor = {
				trigger_event_silently = the_revolution.2
			}
		}
		custom_tooltip = institute_governmental_purges_tt
	}

	ai_will_do = {
		add = 20
	}
}

suppress_foreign_revolutionaries = {
	type = situation
	show_message = no 
	potential = {
		scope:actor = {
			NOT = { revolutionary_target ?= this }
 			is_revolutionary = no 
		}
	}

	allow = {
		
		scope:actor = { 
			at_war = no 
		}
	}
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	price = price:revolution_actions_price

	cooldown = {
		type = suppress_foreign_revolutionaries_key
		years = 5
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		looking_for_a = country
		target_flag = target
		interaction_source_list = {
			every_revolutionary = {
				limit = { within_diplomatic_range = scope:actor }
				add_to_list = source
			}
		}
		name = "choose_country"
		none_available_msg_key = "no_country_available"
		column = { data = name }
		visible = {
			within_diplomatic_range = scope:actor
		}
		enabled = {
			NOR = {
				has_mutual_scripted_relation = {
					type = relation_type:alliance
					target = scope:actor
				}
				is_subject_of = scope:actor
				scope:actor = { is_subject_of = root }
				has_truce_with = scope:actor
			}
			is_rebel_country = no
		}
	}
	effect = { 
		if = {
			limit = { exists = scope:target }
			scope:actor = {
				add_casus_belli = {	target = scope:target type = casus_belli:crush_the_revolution_cb }
			}
		}
		else = { custom_tooltip = suppress_foreign_revolutionaries_tt }
	}

	ai_will_do = {
		add = 20
	}
}

assist_foreign_revolutionaries = {
	type = situation
	show_message = no 
	potential = {
		scope:actor = {
			OR = {
				is_revolutionary = yes
				is_revolution_target = yes
			}
		}
	}

	allow = {
		scope:actor = {
			at_war = no
			manpower_percentage > 0.2
		}
	}
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12
	price = price:revolution_actions_price

	cooldown = {
		type = assist_foreign_revolutionaries_key
		years = 5
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		looking_for_a = country
		target_flag = target
		interaction_source_list = {
			every_revolutionary = {
				limit = { within_diplomatic_range = scope:actor }
				add_to_list = source
			}
		}
		name = "choose_country"
		none_available_msg_key = "no_country_available"
		column = { data = name }
		visible = {
			within_diplomatic_range = scope:actor
		}
		enabled = {
			is_rebel_country = no
			any_current_war = {
				casus_belli ?= casus_belli:crush_the_revolution_cb
				defender_leader = root
			}
		}
	}
	effect = { 
		if = {
			limit = { exists = scope:target }
			scope:actor = {
				trigger_event_non_silently = the_revolution.3
			}
		}
		else = { custom_tooltip = assist_foreign_revolutionaries_tt }
	}

	ai_will_do = {
		add = 20
	}
}

elevate_local_aristocracy = {
	type = situation
	show_message = no 
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	allow = {
		scope:actor = { at_war = no }
	}
	price = price:revolution_actions_price

	cooldown = {
		type = elevate_local_aristocracy_key
		months = 6
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		source = actor
		looking_for_a = province
		target_flag = target_province
		name = "choose_province"
		none_available_msg_key = "no_province_available"
		column = { data = name }
		column = { data = population }
		column = { data = province_tax_base }
		column = { data = satisfaction }
		visible = {
			NOT = { has_variable = recent_aristocracy_upheaval_variable }
			any_location_in_province = {
				AND = {
					any_pop = {
						pop_type = pop_type:nobles
					}
					any_pop = { has_rebel = yes }
				}
			}
		}
	}
	effect = { 
		if = {
			limit = {
				exists = scope:target_province
			}
			scope:target_province = {
				hidden_effect = {
					set_variable = {
						name = recent_aristocracy_upheaval_variable
						years = 2
					}
				}
				custom_tooltip = {
					text = every_noble_in_target_province_gains_mild_satisfaction_tt
					every_location_in_province = {
						limit = { 
							AND = {
								any_pop = { 
									owner ?= scope:actor
									pop_type = pop_type:nobles
								}
							}
						}
						every_pop = {
							limit = {
								owner ?= scope:actor
								pop_type = pop_type:nobles
							}
							add_pop_satisfaction = pop_satisfaction_mild_bonus
						}
					}
				}
			}
		}
		else = { custom_tooltip = elevate_local_aristocracy_tt }
		scope:actor = { 
			change_societal_value = { 
				type = aristocracy_vs_plutocracy 
				value = societal_value_move_to_left 
			}
			change_societal_value = { 
				type = serfdom_vs_free_subjects 
				value = societal_value_move_to_left 
			}
		}
	}

	ai_will_do = {
		add = 20
	}
}

demote_local_aristocracy = {
	type = situation
	show_message = no 
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	allow = {
		scope:actor = { at_war = no }
	}
	price = price:revolution_actions_price

	cooldown = {
		type = demote_local_aristocracy_key
		months = 6
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		source = actor
		looking_for_a = province
		target_flag = target_province
		name = "choose_province"
		none_available_msg_key = "no_province_available"
		column = { data = name }
		column = { data = population }
		column = { data = province_tax_base }
		column = { data = satisfaction }
		visible = {
			NOT = { has_variable = recent_aristocracy_upheaval_variable }
			any_location_in_province = {
				any_pop = {
					pop_type = pop_type:nobles
				}
			}
		}
		enabled = {
			NOT = { has_province_modifier = rev_demoted_aristocracy_modifier }
		}
	}
	effect = { 
		if = {
			limit = {
				exists = scope:target_province
			}
			scope:target_province = {
				hidden_effect = {
					set_variable = {
						name = recent_aristocracy_upheaval_variable
						years = 2
					}
				}
				add_province_modifier = {
					modifier = rev_demoted_aristocracy_modifier
					years = modifier_duration_years_long
					mode = replace
				}
				custom_tooltip = {
					text = every_noble_in_target_province_suffers_severe_penalty_tt
					every_location_in_province = {
						limit = { 
							any_pop = { 
								owner ?= scope:actor
								pop_type = pop_type:nobles 
							}
						}
						every_pop = {
							limit = {
								owner ?= scope:actor
								pop_type = pop_type:nobles
							}
							add_pop_satisfaction = pop_satisfaction_severe_penalty
						}
					}
				}
				province_capital = {
					if = {
						limit = {
							any_buildings_in_location = {
								building_pop_type = nobles
								owner = scope:actor
							}
						}
						ordered_buildings_in_location = {
							order_by = building_level
							limit = {
								building_pop_type = nobles
								owner = scope:actor
							}
							max = {
								value = 1
								add = {
									value = num_buildings
									divide = 10
								}
							}
							check_range_bounds = no
							location = { destroy_building = prev }
						}
					}
				}
			}
		}
		else = { custom_tooltip = demote_local_aristocracy_tt }
		scope:actor = { 
			change_societal_value = { 
				type = aristocracy_vs_plutocracy 
				value = societal_value_move_to_right
			}
			change_societal_value = { 
				type = serfdom_vs_free_subjects 
				value = societal_value_move_to_right 
			}
		}
	}

	ai_will_do = {
		add = 20
	}
}

reestablish_the_parliament = {
	type = situation
	show_message = no 
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	allow = {
		scope:actor = { 
			has_policy = absolute_rule_policy
			government_power >= {
				value = {
					add = 100
					multiply = "scope:actor.estate_power(estate_type:crown_estate)"
					add = 1
					ceiling = yes
				}
			}
		}
	}
	price = price:revolution_actions_price

	cooldown = {
		type = reestablish_the_parliament_key
		years = 5
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}
	
	effect = { 
		scope:actor = {
			custom_tooltip = according_to_our_crown_power_we_suffer_tt
			add_government_power = {
				value = -100
				multiply = "scope:actor.estate_power(estate_type:crown_estate)"
				floor = yes
			}
			remove_policy = policy:absolute_rule_policy
			change_societal_value = { 
				type = serfdom_vs_free_subjects 
				value = societal_value_large_move_to_right 
			}
			custom_tooltip = estate_satisfaction_gain_scales_with_estate_power_tt
			add_estate_satisfaction = { 
				type = estate_type:burghers_estate 
				value = {
					add = estate_satisfaction_radical_bonus
					multiply = "scope:actor.estate_power(estate_type:burghers_estate)"
				}
			}
			add_estate_satisfaction = { 
				type = estate_type:peasants_estate 
				value = {
					add = estate_satisfaction_radical_bonus
					multiply = "scope:actor.estate_power(estate_type:peasants_estate)"
				}
			}
			add_estate_satisfaction = { 
				type = estate_type:nobles_estate 
				value = {
					add = -1
					multiply = "scope:actor.estate_power(estate_type:nobles_estate)"
				}
			}
			
		}
	}

	ai_will_do = {
		add = 20
	}
}

spread_revolutionary_sentiment = {
	type = situation
	show_message = no 
	potential = {
		scope:actor = { is_revolutionary = yes }
	}

	allow = {
		scope:actor = {
			at_war = no
			is_subject = no
		}
	}
	
	ai_tick = monthly
	ai_tick_frequency = 4

	automation_tick = never
	automation_tick_frequency = 12

	price = price:revolution_actions_price

	cooldown = {
		type = spread_revolutionary_sentiment
		years = 5
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:the_revolution = this
			situation_is_active = yes
		} 
	}

	select_trigger = {
		looking_for_a = country
		interaction_source_list = {
			scope:actor = {
				every_country_in_diplomatic_range = {
					limit = { 
						is_revolutionary = no
						in_civil_war = no
						scope:actor = { can_declare_war_on = prev }
						num_provinces > 1
					}
					add_to_list = source
				}
			}
		}
		target_flag = target_country
		name = "choose_country"
		column = { data = name }
		column = { data = regular_army_size }
		column = { data = great_power_score }
	}
	effect = { 
		if = {
			limit = { exists = scope:target_country }
			custom_tooltip = {
				text = revolution_in_selected_country_tt
				scope:target_country = { trigger_event_non_silently = the_revolution.11 }
			}
		}
		else = { custom_tooltip = revolution_in_country_tt }
	}

	ai_will_do = {
		value = -50
		if = {
			limit = { exists = scope:target_country }
			add = {
				value = scope:actor.num_provinces
				subtract = scope:target_country.num_provinces
			}
			if = {
				limit = { 
					scope:target_country = {
						OR = { 
							is_rival_of = scope:actor
							is_enemy_of = scope:actor
						}
					}
				}
				add = 100
			}
			if = {
				limit = {
					scope:target_country = { is_great_power = yes }
				}
				add = 25
			}
			if = {
				limit = {
					scope:target_country = { is_hegemon = yes }
				}
				add = 25
			}
			if = {
				limit = {
					scope:actor = {
						relative_strength = {
							target = scope:target_country
							value > 0.5
						}
					}
				}
				subtract = 25
			}
			else = { add = 25 }
			if = {
				limit = { 
					scope:actor = { 
						NOT = { is_neighbor_of = scope:target_country }
					}
				}
				subtract = 25
			}
		}
	}
}