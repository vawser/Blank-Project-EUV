
#NAHUATL RELIGION
appease_the_gods = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:nahuatl
	}

	allow = {
		scope:actor = {
			capital = {
				any_pop = {
					pop_type = pop_type:slaves
					pop_size >= 0.1
				}
			}
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines

	cooldown = {
		type = appease_the_gods
		years = 3
	}
	
	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	effect = {
		scope:actor.capital = {
			random_pop = {
				limit = {
					pop_type = pop_type:slaves
				}
				add_pop_size = {
					value = -0.1
				}
			}
		}
		scope:actor = {
			if = {
				limit = {
					has_completed_religious_focus = raise_sacrifice_rate
				}
				add_doom = doom_severe_bonus
			}
			else = { add_doom = doom_mild_bonus }
		}
	}

	ai_will_do = {
		#base
		value = 0
		scope:actor = {
			if = {
				limit = { has_completed_religious_focus = raise_sacrifice_rate }
				subtract = doom_severe_bonus
			}
			else = {
				subtract = doom_mild_bonus
			}
			add = scope:actor.doom
			if = {
				limit = {
					can_do_generic_action = {
						generic_action = generic_action:ceremonial_festivals
						recipient = scope:actor.religion
					}
				}
				multiply = 0
			}
		}
	}
}

ceremonial_festivals = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:nahuatl
	}

	allow = {
		scope:actor.capital = {
			any_pop = {
				pop_type = pop_type:slaves
				pop_size >= 0.4
			}
		}
		scope:actor.gold >= {
			value = scope:actor.monthly_income_trade_and_tax
			multiply = 4
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines

	cooldown = {
		type = ceremonial_festivals
		years = 1
	}
	
	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	effect = {
		custom_tooltip = {
			text = explanation_ceremony_tt
		}
		if = {
			limit = {
				time_of_year = {
					min = 2.14
					max = 3.5 
				}
			}
			custom_tooltip = {
				text = atlcahualo_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 3.6
					max = 3.25 
				}
			}
			custom_tooltip = {
				text = tlacaxipehualiztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 3.26
					max = 4.14 
				}
			}
			custom_tooltip = {
				text = tozoztontli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 4.15
					max = 5.4 
				}
			}
			custom_tooltip = {
				text = huey_tozoztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 5.5
					max = 5.22 
				}
			}
			custom_tooltip = {
				text = toxcatl_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 5.23
					max = 6.13 
				}
			}
			custom_tooltip = {
				text = etzalcualiztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 6.14
					max = 7.3
				}
			}
			custom_tooltip = {
				text = tecuilhuitontli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 7.4
					max = 7.23 
				}
			}
			custom_tooltip = {
				text = huey_tecuilhuitli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 7.24
					max = 8.12 
				}
			}
			custom_tooltip = {
				text = tlaxochimaco_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 8.13
					max = 9.1 
				}
			}
			custom_tooltip = {
				text = xocotl_huetzi_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 9.2
					max = 9.21
				}
			}
			custom_tooltip = {
				text = ochpaniztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 9.22
					max = 10.11 
				}
			}
			custom_tooltip = {
				text = teteo_eco_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 10.12
					max = 10.31 
				}
			}
			custom_tooltip = {
				text = tepeilhuitl_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 11.1
					max = 11.20 
				}
			}
			custom_tooltip = {
				text = quecholli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 11.21
					max = 12.10 
				}
			}
			custom_tooltip = {
				text = panquetzaliztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 12.11
					max = 12.30
				}
			}
			custom_tooltip = {
				text = atemoztli_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 12.31
					max = 1.19
				}
			}
			custom_tooltip = {
				text = tititl_tt
			}
		}
		else_if = {
			limit = {
				time_of_year = {
					min = 1.20
					max = 2.8 
				}
			}
			custom_tooltip = {
				text = izcalli_tt
			}
		}
		else = {
			custom_tooltip = {
				text = nemontemi_tt
			}
		}
		scope:actor = {
			trigger_event_non_silently = nahuatl_events.310
		}
	}

	ai_will_do = {
		#base, if affordable, always do
		value = 100
	}
}

open_war_path = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:nahuatl
	}

	allow = {
		scope:actor = {
			has_completed_religious_focus = institute_flower_wars
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines

	cooldown = {
		type = open_war_path
		years = 2
	}
	
	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	select_trigger = {
		looking_for_a = country
		interaction_source_list = {
			scope:actor = {
				every_subject_or_below = {
					every_neighbor_country = {
						limit = {
							scope:actor = { can_declare_war_on = prev }
						}
						add_to_list = source
					}
				}
				every_neighbor_country = {
					limit = {
						scope:actor = { can_declare_war_on = prev }
					}
					add_to_list = source
				}
			}
		}
		target_flag = target_country
		name = "choose_country"
		none_available_msg_key = "no_countries_available"
		column = { data = name }
		column = { data = population }
		column = { data = expected_army_size }
		visible = {
			NOT = { is_at_war_with = scope:actor }
		}
	}

	effect = {
		if = {
			limit = { exists = scope:target_country }
			scope:actor = {
				add_casus_belli = {	
					target = scope:target_country	
					type = casus_belli:cb_flower_wars	
				}
			}
		}
		else = { custom_tooltip = flower_war_cb_against_country_tt }
	}

	ai_will_do = {
		add = -5
		if = {
			limit = { exists = scope:target_country }
			if = {
				limit = { 
					scope:actor = { at_war = yes }
				}
				subtract = 200
			}
			if = {
				limit = {
					scope:actor = {
						relative_strength = {
							target = scope:target_country
							value > 0.5
						}
					}
				}
				add = {
					value = 100
					multiply = "scope:actor.relative_strength(scope:target_country)"
				}
			}
			else = { subtract = 25 }	#They should never want to get a CB against a country that the AI is weaker to.
			if = {
				limit = {
					scope:actor = { num_loans > 0 }
				}
				subtract = scope:actor.num_loans
			}
			if = {
				limit = { 
					scope:actor.stability > 0 
				}
				add = {
					value = scope:actor.stability
					multiply = 0.05
				}
			}
			else_if = {
				limit = { scope:actor.stability < -10 }
				subtract = {
					value = scope:actor.stability
					multiply = 0.1
				}
			}
			if = {
				limit = {
					scope:target_country = { at_war = yes }
				}
				add = 10
			}
		}
	}
}

pilgrimage_to_cholula = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:nahuatl
	}
	allow = {
		scope:actor ?= {
			has_religious_aspect = religious_aspect:worship_quetzalcoatl_god
		}
	}

	cooldown = {
		type = pilgrimage_to_cholula
		years = 25
	}

	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines

	price = price:pilgrimage_purity

	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	effect = {
		scope:actor = {
			if = {
				limit = {
					owns = location:cholollan
				}
				add_stability = stability_severe_bonus
			}
			else = {
				add_stability = stability_mild_bonus
			}
		}
	}

	ai_tick = daily
	ai_tick_frequency = 80
	ai_will_do = 10
}

reform_society_action = {
	type = religious

	sound = UI_action_religion_generic

	show_message = no
	potential = {
		scope:actor.religion = religion:nahuatl
		scope:actor = {
			NOT = { has_variable = eligible_for_reform_society_disaster_variable }
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 3

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines

	allow = {
		scope:actor = {
			has_any_active_disaster = no
			OR = {
				num_locations >= 20
				num_subjects >= 5
			}
			custom_tooltip = {
				text = has_completed_all_religious_focuses_tt
				has_completed_religious_focus = adopt_ometeotl
				has_completed_religious_focus = elevate_patron_god
				has_completed_religious_focus = establish_cihuacoatl
				has_completed_religious_focus = expand_cuahpipiltin
				has_completed_religious_focus = increase_militarism
				has_completed_religious_focus = institute_flower_wars
				has_completed_religious_focus = legal_reforms
				has_completed_religious_focus = raise_sacrifice_rate
			}
		}
	}

	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = {
			data = name
		}
	}

	effect = {
		custom_tooltip = commence_reform_society_disaster_tt
		scope:actor = {
			show_as_tooltip = {
				add_stability = stability_extreme_bonus
				remove_reform = government_reform:altepetl
				add_reform = government_reform:reformed_nahuatl_society
				custom_tooltip = annex_all_altepetls_tt
			}
			hidden_effect = { set_variable = eligible_for_reform_society_disaster_variable }
		}
	}

	ai_will_do = 100
}
