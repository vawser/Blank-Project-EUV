create_building_subject = {
	type = owncountry

	allow = {
		scope:actor = {
			has_limited_diplomacy = no
		}
	}

	select_trigger = {
		looking_for_a = region
		interaction_source_list = {
			scope:actor = {
				every_owned_foreign_building_region = {
					add_to_list = source
				}
			}
		}
		target_flag = target_region
		name = "create_building_subject_select_region"
		none_available_msg_key = "create_building_subject_no_region"
		column = {
			data = name
		}
		visible = {
			scope:actor = {
				capital = {
					region != root
				}
			}
		}
	}

	select_trigger = {
		looking_for_a = subject_type
		target_flag = subject_type
		cache_targets = yes #this list of targets doesn't rely on the previous target so we only need to do it once
		name = "create_building_subject_select_subject_type"
		none_available_msg_key = "create_building_subject_no_subject_type"
		column = {
			data = subject_type_attribute_column
		}
		column = { data = subject_type_icon }
		visible = {
			subject_can_be_created_by = {
				country = scope:actor
				where = scope:target_region
			}
		}
	}
	
	select_trigger = {
		show_if = {
			exists = scope:subject_type
			scope:subject_type = {
				has_overlords_ruler = no
			}
		}
		looking_for_a = character
		source = actor
		target_flag = ruler
		cache_targets = yes #this list of targets doesn't rely on the previous target so we only need to do it once
		allow_null = yes #so we let the game create a random ruler
		name = "create_building_subject_select_ruler"
		none_available_msg_key = "create_building_subject_no_ruler"
		column = {
			data = character_info
			widget = character_info_for_select_ruler
		}
		visible = {
			can_become_a_ruler = yes
			scope:actor = {
				trigger_if = {
					limit = {
						exists = ruler
					}
					ruler != root
				}
			}
		}
	}
	
	effect = {
		if = {
			limit = {
				exists = scope:target_region
				exists = scope:ruler
			}

			scope:actor = {
				ordered_owned_foreign_building = {
					limit = {
						location = {
							region = scope:target_region
						}
					}
					order_by = building_level
					max = 1
					
					location = {
						create_building_country_in_location = {
							region = scope:target_region
							ruler = scope:ruler
							subject_type = scope:subject_type
							overlord = scope:actor
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				exists = scope:target_region
			}

			#using overlord's ruler
			scope:actor = {
				ruler = {
					save_scope_as = ruler
				}
			}

			scope:actor = {
				ordered_owned_foreign_building = {
					limit = {
						location = {
							region = scope:target_region
						}
					}
					order_by = building_level
					max = 1
					
					location = {
						create_building_country_in_location = {
							region = scope:target_region
							ruler = scope:ruler
							subject_type = scope:subject_type
						}
					}
				}
			}
		}
	}
	
	ai_tick = never #We do not want the AI to release subject countries...
	ai_tick_frequency = 6
	ai_will_do = 0

	automation_tick = never
	automation_tick_frequency = 12
}