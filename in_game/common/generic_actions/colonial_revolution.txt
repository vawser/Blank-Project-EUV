#Action for Overlord "Aid Colony" if Colony is at war, send manpower and money, decrease LD
#

#############################################
#      Actions for the Colonial Nations     #
#############################################

seek_alliance_with_overlord_rival = {
	type = situation
	
	ai_tick = daily
	ai_tick_frequency = 80
	automation_tick = monthly
	automation_tick_frequency = 1

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor = {
			is_subject = yes
			is_colonial_subject = yes
		}
	}

	allow = {
		scope:actor = {
			overlord ?= {
				any_rival = {
					count > 0
				}
			}
		}
		custom_tooltip = {
			text = overlord_rival_is_available.tt
		}
	}
	
	price = price:seek_alliance_with_overlord_rival
	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor ?= {
			trigger_event_non_silently = colonial_revolution.1000
		}
	}
	cooldown = { type = seek_alliance_with_overlord_rival_cooldown_key years = 5 }
	ai_will_do = {
		add = 10
	}
}

declare_independence_war = {
	type = situation
	
	ai_tick = daily
	ai_tick_frequency = 80
	automation_tick = monthly
	automation_tick_frequency = 1
	
	potential = {
		scope:actor ?= {
			is_colonial_subject = yes
		}
	}
	allow = {
		scope:actor ?= {
			at_war = no
			subject_loyalty < 50
			NOT = {
				has_truce_with = scope:actor.overlord
			}
		}
	}

	price = price:declare_independence_war

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor ?= {
			declare_war_with_cb = {
				target = scope:actor.overlord
				type = casus_belli:cb_independence_war
			}
		}
		
	}
	ai_will_do = {
		#Base value
		add = {
			value = 50
			subtract = scope:actor.subject_loyalty
			multiply = 2
		}
		scope:actor = {
			#Do it depending on opinion
			add = {
				value = -1
				overlord ?= {
					multiply = scope:actor.this_opinion_of_prev
					multiply = 0.025
				}
			}
		}
	}
}

create_colonial_federation = {
	type = situation

	ai_tick = monthly
	ai_tick_frequency = 6
	automation_tick = monthly
	automation_tick_frequency = 1

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor ?= {
			is_colonial_subject = yes
		}
	}

	allow = {
		scope:actor ?= {
			at_war = no
			subject_loyalty < 25
			NOT = {
				is_member_of_international_organization_of_type = { type = colonial_federation }
			}
		}
	}
	
	price = price:seek_alliance_with_overlord_rival
	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	effect = {
		custom_tooltip = cf_create_colonial_federation_tt
		hidden_effect = {
			scope:actor = {
				create_international_organization = {
					type = international_organization_type:colonial_federation
					add_country_to_international_organization = prev
					set_leader_country = prev
					#so we can use it in text
					save_scope_as = target
				}
			}
		}
	}

	ai_will_do = {
		#Base value
		add = {
			value = -10
		}
		scope:actor = {
			#Do it depending on opinion
			add = {
				value = -1
				overlord ?= {
					multiply = scope:actor.this_opinion_of_prev
					multiply = 0.2
				}
			}
		}
	}
}

join_colonial_federation = {
	type = situation
	
	ai_tick = monthly
	ai_tick_frequency = 6
	automation_tick = monthly
	automation_tick_frequency = 1

	automation_tick = never
	automation_tick_frequency = 12

	potential = {
		scope:actor ?= {
			is_colonial_subject = yes
		}
	}

	allow = {
		scope:actor = {
			OR = {
				#not in one
				not = {
					is_member_of_international_organization_of_type = {
						type = colonial_federation
					}
				}
			}
		}
	}
	
	price = price:seek_alliance_with_overlord_rival

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = international_organization
		target_flag = target
		name = "join_colonial_federation_choose_cf"
		none_available_msg_key = "join_colonial_federation_no_ios"
		column = {
			data = name
		}
		visible = {
			international_organization_type = international_organization_type:colonial_federation
		}
		enabled = {
			scope:actor = {
				can_join_international_organization = root
			}
		}
	}

	effect = {
		if = {
			limit = {
				exists = scope:target
			}
			scope:target = {
				add_country_to_international_organization = scope:actor
			}
		}
	}

	ai_will_do = {
		add = -5
		add = {
			if = {
				limit = {
					scope:actor = {
						subject_loyalty < 40
					}
				}
				value = 20
			}
		}
		add = {
			value = scope:target.total_members
		}
	}
}

#####################################
#      Actions for the Overlord     #
#####################################

give_colony_representation = {
	type = situation
	
	ai_tick = daily
	ai_tick_frequency = 80
	automation_tick = monthly
	automation_tick_frequency = 1
	
	potential = {
		scope:actor ?= {
			is_colonial_overlord = yes
		}
	}
	allow = {
	}

	price = price:give_colony_representation

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = country
		target_flag = target_country
		name = "choose_country"
		none_available_msg_key = "no_valid_countries"
		column = {
			data = name
		}
		visible = {
			is_colonial_subject = yes
			overlord = scope:actor
			has_policy = colonial_representation_law_no
		}
	}

	effect = {
		scope:target_country ?= {
			add_policy = policy:colonial_representation_law_yes
		}
		
	}
	ai_will_do = {
		#Base value
		add = {
			value = 1
		}
	}
}

establish_goods_act = {
	type = situation
	
	ai_tick = monthly
	ai_tick_frequency = 6
	automation_tick = monthly
	automation_tick_frequency = 1
	
	potential = {
		scope:actor ?= {
			is_colonial_overlord = yes
		}
	}
	allow = {
		scope:actor ?= {
			NOT = {
				has_cooldown = recently_established_goods_act
			}
		}
	}

	price = price:establish_goods_act

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = country
		target_flag = target_country
		name = "choose_country"
		none_available_msg_key = "no_valid_countries"
		column = {
			data = name
		}
		visible = {
			is_colonial_subject = yes
			overlord ?= scope:actor
		}
	}

	effect = {
		if = {
			limit = {
				exists = scope:target_country
			}
			scope:target_country ?= {
				transfer_yearly_gold = {
					value = 0.5
					target = scope:actor
				}
				add_liberty_desire = liberty_desire_mild_plus
			}
		}
		else = {
			custom_tooltip = establish_goods_act_tt
		}
		scope:actor ?= {
			add_cooldown = {
				type = recently_established_goods_act
				years = 4
			}
		}
	}
	ai_will_do = {
		add = -10
		add = {
			if = {
				limit = {
					scope:target_country = {
						subject_loyalty > 70
					}
				}
			}
			value = 20
		}
		add = {
			if = {
				limit = {
					scope:target_country = {
						subject_loyalty < 50
					}
				}
			}
			value = -20
		}
		add = {
			if = {
				limit = {
					scope:target_country = {
						is_during_bankruptcy = yes
					}
				}
			}
			value = -20
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						is_during_bankruptcy = yes
					}
				}
			}
			value = 20
		}
	}
}

aid_colonial_war = {
	type = situation
	
	ai_tick = monthly
	ai_tick_frequency = 6
	automation_tick = monthly
	automation_tick_frequency = 1
	
	potential = {
		scope:actor ?= {
			is_colonial_overlord = yes
		}
	}
	allow = {
		scope:actor ?= {
			NOT = {
				has_cooldown = recently_aid_colonial_war
			}
		}
	}

	price = price:aid_colonial_war

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = country
		target_flag = target_country
		name = "choose_country"
		none_available_msg_key = "no_valid_countries"
		column = {
			data = name
		}
		visible = {
			is_colonial_subject = yes
			overlord = scope:actor
			at_war = yes
		}
	}

	effect = {
		if = {
			limit = {
				exists = scope:target_country
			}
			scope:actor ?= {
				transfer_yearly_manpower = {
					value = 0.25
					target = scope:target_country
				}
			}
			scope:target_country ?= {
				add_liberty_desire = liberty_desire_mild_minus
			}
		}
		else = {
			custom_tooltip = aid_colonial_war_tt
		}
		scope:actor ?= {
			add_cooldown = {
				type = recently_aid_colonial_war
				years = 2
			}
		}
	}
	ai_will_do = {
		add = -10
		add = {
			if = {
				limit = {
					scope:target_country = {
						subject_loyalty < 50
					}
				}
			}
			value = 20
		}
		add = {
			if = {
				limit = {
					scope:target_country = {
						subject_loyalty > 70
					}
				}
			}
			value = -20
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						manpower_percentage < 0.5
					}
				}
			}
			value = -20
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						manpower_percentage > 0.9
					}
				}
			}
			value = 100
		}
	}
}

########################################
#      Actions for Other Countries     #
########################################

give_colony_rebellion_support = {
	type = situation
	
	ai_tick = monthly
	ai_tick_frequency = 4
	automation_tick = monthly
	automation_tick_frequency = 1
	
	potential = {
	}
	allow = {
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:colonial_revolution = this
			situation_is_active = yes
		}
	}

	price = price:give_colony_rebellion_support

	select_trigger = {
		looking_for_a = country
		target_flag = target_country
		name = "choose_country"
		none_available_msg_key = "no_valid_countries"
		column = {
			data = name
		}
		interaction_source_list = {
			every_colonial_country = {
				add_to_list = source
			}
		}
		visible = {
			overlord ?= { this != scope:actor }
			opinion = { target = this.overlord value <= 50 }
			NOT = {
				has_opinion = { target = this.overlord modifier = opinion_agitated_colony }
			}
			scope:actor = { knows_country = root }
		}
	}

	effect = {
		scope:target_country ?= {
			add_opinion = { target = scope:target_country.overlord modifier = opinion_agitated_colony }
			add_opinion = { target = scope:actor modifier = opinion_given_support }
			overlord ?= {
				add_opinion = { target = scope:actor modifier = opinion_agitated_colony }
			}
		}
		
	}
	ai_will_do = {
		#Base value
		add = {
			value = 1
		}
		scope:actor ?= {
			#Do it depending on opinion
			add = {
				value = -1
				scope:target ?= {
					overlord ?= {
						multiply = scope:actor.this_opinion_of_prev
						multiply = 0.1
					}
				}
			}
		}
	}
}