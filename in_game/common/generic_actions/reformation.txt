embrace_the_reformation = {
	type = situation

	potential = {
		scope:actor = {
			religion = religion:catholic
			NOT = {
				tag = PAP
			}
		}
	}

	allow = {
		is_situation_active = situation:reformation
		trigger_if = {
			limit = {
				scope:actor = {
					is_human = no
				}
			}
			religion:lutheran = {
				num_countries_in_religion < 20
			}
			religion:calvinist = {
				num_countries_in_religion < 20
			}
			scope:actor = {
				OR = {
					religion_percentage_in_country = {
						religion = religion:lutheran
						value > 0
					}
					religion_percentage_in_country = {
						religion = religion:calvinist
						value > 0
					}
				}
			}
		}
		trigger_else = {
			scope:actor = {
				OR = {
					religion_percentage_in_country = {
						religion = religion:lutheran
						value > 0
					}
					religion_percentage_in_country = {
						religion = religion:calvinist
						value > 0
					}
				}
			}
		}
	}

	automation_tick = never
	automation_tick_frequency = 12

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:reformation = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = religion
		target_flag = target
		name = "convert_religion_select_religion"
		none_available_msg_key = "convert_religion_no_religions"
		column = {
			data = name
		}
		visible = {
			OR = {
				root = religion:lutheran
				root = religion:calvinist
			}
			is_religion_enabled = yes
		}
	}

	effect = {
		if = {
			limit = {
				exists = scope:target
			}
			scope:actor = {
				change_religion = scope:target
				change_religion_for_ruler_and_family = { country = scope:actor religion = scope:target }
				if = {
					limit = {
						government_type = government_type:theocracy
					}
					add_stability = stability_severe_penalty
					add_prestige = prestige_severe_penalty
					change_government_type = government_type:monarchy
				}
				ruler ?= { remove_character_modifier = enacted_placitum_regium }
			}
		}
		else = {
			custom_tooltip = embrace_the_reformation_tt
		}
	}

	ai_will_do = {
		add = -100
		add = {
			if = {
				limit = {
					scope:target = {
						num_countries_in_religion < 10
					}
					scope:actor = { #this could also check for lutheran_preachers calvinist_preachers in country
						religion_percentage_in_country = {
							religion = scope:target
							value > 0
						}
					}
				}
				value = 1000 #countries will convert once more than 10% of their country is of that religion
				multiply = "scope:actor.religion_percentage_in_country(scope:target)"
			}
		}
		add = {
			if = {
				limit = {
					scope:target = {
						num_countries_in_religion > 9
						num_countries_in_religion < 20
					}
					scope:actor = { #this could also check for lutheran_preachers calvinist_preachers in country
						religion_percentage_in_country = {
							religion = scope:target
							value > 0
						}
					}
				}
				value = 500  #countries will convert once more than 20% of their country is of that religion
				multiply = "scope:actor.religion_percentage_in_country(scope:target)"
			}
		}
	}
}
