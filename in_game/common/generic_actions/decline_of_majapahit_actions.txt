restrict_peranakan_trading_rights = {
	type = disaster
	show_message = no
	potential = {
		scope:actor = {
			NOT = { has_country_modifier = peranakan_trading_rights_restriction }
		}
	}

	price = price:restrict_peranakan_trading_rights_price

	automation_tick = never
	automation_tick_frequency = 12

	allow = {
		scope:actor = {
			stability >= 60
		}
	}

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			add_country_modifier = {
				modifier = peranakan_trading_rights_restriction
				mode = replace
				years = -1
			}
			custom_tooltip = peranakan_trading_rights_restriction_event_impact
		}
	}

	ai_will_do = {
		value = "scope:actor.add_static_modifier_utility(peranakan_trading_rights_restriction)"
		subtract = 1 #base reluctance to do anything
	}
}

unrestrict_peranakan_trading_rights = {
	type = disaster
	show_message = no
	potential = {
		scope:actor = {
			has_country_modifier = peranakan_trading_rights_restriction
		}
	}

	automation_tick = never
	automation_tick_frequency = 12

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = { 
		scope:actor = {
			remove_country_modifier = peranakan_trading_rights_restriction
		}
	}

	ai_will_do = {
		value = "scope:actor.add_static_modifier_utility(peranakan_trading_rights_restriction)"
		multiply = -1
		subtract = 1 #base reluctance to do anything
	}
}

ban_conversion_of_adipatis = {
	type = disaster
	show_message = no
	potential = {
		scope:actor = {
			NOT = { has_country_modifier = adipati_conversion_ban }
		}
	}

	automation_tick = never
	automation_tick_frequency = 12

	price = price:ban_conversion_of_adipatis_price

	allow = {
		scope:actor = {
			stability >= 60
		}
	}

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = { 
		scope:actor = {
			add_country_modifier = {
				modifier = adipati_conversion_ban
				mode = replace
				years = -1
			}
		}
		custom_tooltip = MAJ_for_as_long_as_this_modifier_is_active
	}

	ai_will_do = {
		value = "scope:actor.add_static_modifier_utility(peranakan_trading_rights_restriction)"
		add = "scope:actor.religion_percentage_in_country(religion:sunni)"
		subtract = 1 #base reluctance to do anything
	}
}

unban_conversion_of_adipatis = {
	type = disaster
	show_message = no
	potential = {
		scope:actor = { has_country_modifier = adipati_conversion_ban }
	}

	automation_tick = never
	automation_tick_frequency = 12

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = { 
		scope:actor = {
			remove_country_modifier = adipati_conversion_ban
		}
	}

	ai_will_do = {
		value = 1
		subtract = "scope:actor.religion_percentage_in_country(religion:sunni)"
		add = {
			value = "scope:actor.add_static_modifier_utility(peranakan_trading_rights_restriction)"
			multiply = -1
		}
	}
}

control_the_bhres = {
	type = disaster
	show_message = no
	potential = {
		scope:actor = {
			has_variable = demak_progress
		}
	}

	automation_tick = never
	automation_tick_frequency = 12

	price = price:control_the_bhres_price

	allow = {
		scope:actor = {
			custom_tooltip = {
				text = demak_progress_at_least_20
				var:demak_progress >= 0.2
			}
		}
	}

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			custom_tooltip = {
				text = MAJ_reduce_sunni_dominance
				change_variable = {
					name = demak_progress
					subtract = 0.1
				}
			}
		}
	}

	ai_will_do = {
		value = 0
		add = {
			value = scope:actor.var:demak_progress
			multiply = {
				value = 1
				add = {
					value = scope:actor.stability
					divide = 100
				}
			}
		}
	}
}

maj_convert_to_islam = {
	type = disaster
	show_message = no

	allow = {
		scope:actor.religion.group != religion_group:muslim
		"scope:actor.religion_percentage_in_country(religion:sunni)" > 0.3
	}

	automation_tick = never
	automation_tick_frequency = 12

	select_trigger = {
		looking_for_a = disaster
		target_flag = recipient
		name = "choose_disaster"
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:decline_of_majapahit
			disaster_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			change_religion = religion:sunni
			change_religion_for_ruler_and_family = { country = scope:actor religion = religion:sunni }
			capital = {
				every_pop = {
					limit = {
						NOT = {
							religion = religion:sunni
						}
					}
					split_pop = {
						fraction = 0.25
						religion = religion:sunni
					}
				}
			}

			custom_tooltip = maj_consequences_of_conversion
			show_as_tooltip = {
				add_legitimacy = legitimacy_radical_penalty
				add_stability = stability_radical_penalty
			}
		}
	}

	ai_will_do = { # AI will want to convert after 50% threshold and its reasons to do so will rapidly increase 
		value = 0
		add = {
			value = "scope:actor.religion_percentage_in_country(religion:sunni)"
			subtract = 0.5
			multiply = 200
			min = 0
		}
		subtract = { # A more spiritualist country will have a higher threshold
			value = scope:actor.societal_value:spiritualist_vs_humanist
			multiply = -100
			min = 0
		}
		subtract = { # A stable country will be less desperate to convert
			value = scope:actor.stability
			multiply = -1
			min = 0
		}
	}
}