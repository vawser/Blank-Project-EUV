# scope:actor = country, scope:recipient = religion

cleansing_ritual_yanantin = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = {
			has_yanantin = yes
		}
	}

	allow = {
	}

	ai_tick = monthly
	ai_tick_frequency = 6

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines
	
	price = price:cleansing_ritual_yanantin
	
	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = { data = name }
	}

	select_trigger = {
		looking_for_a = god
		target_flag = target
		name = "favor_god_choose_god"
		none_available_msg_key = "favor_god_no_gods"
		column = { data = name }
		visible = {
			#The country has this god
			scope:actor = {
				any_current_gods = { 
					this = root
				}
			}
		}
	}

	effect = {
		scope:actor = {
			if = {
				limit = {exists = scope:target}
				switch = {
					trigger = scope:target
					#If male god
					god:viracocha = { add_yanantin = -10 }
					god:inti_god = { add_yanantin = -10 }
					god:illapa_god = { add_yanantin = -10 }
					#If female god
					god:mamaquilla = { add_yanantin = 10 }
					god:pachamama = { add_yanantin = 10 }
					god:mama_cocha = { add_yanantin = 10 }
					god:urpihuachac_god = { add_yanantin = 10 }
				}
			}
		}
	}

	ai_will_do = {
		#If male god
		if = {
			limit = {scope:target = god:viracocha}
			add = "scope:actor.currency_utility(yanantin|-10)"
		}
		else_if = {
			limit = {scope:target = god:inti_god}
			add = "scope:actor.currency_utility(yanantin|-10)"
		}
		else_if = {
			limit = {scope:target = god:illapa_god}
			add = "scope:actor.currency_utility(yanantin|-10)"
		}
		#If female god
		else_if = {
			limit = {scope:target = god:mamaquilla}
			add = "scope:actor.currency_utility(yanantin|10)"
		}
		else_if = {
			limit = {scope:target = god:pachamama}
			add = "scope:actor.currency_utility(yanantin|10)"
		}
		else_if = {
			limit = {scope:target = god:mama_cocha}
			add = "scope:actor.currency_utility(yanantin|10)"
		}
		else_if = {
			limit = {scope:target = god:urpihuachac_god}
			add = "scope:actor.currency_utility(yanantin|10)"
		}
	}
}

pilgrimage_yanantin = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = {
			has_yanantin = yes
			has_holy_sites = yes
		}
	}

	allow = {
	}

	ai_tick = monthly
	ai_tick_frequency = 6

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines
	
	price = price:pilgrimage_yanantin
	
	#scope:actor is the country doing the action, scope:target is the holy site
	price_modifier = {
		add = 1
		add = {
			if = {
				limit = {
					exists = scope:target
				}
				value = "scope:actor.capital.distance_to_squared(scope:target.location)"
				multiply = 0.0006
			}
		}
	}

	cooldown = {
		type = pilgrimage_yanantin
		years = 1
	}

	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = { data = name }
	}

	select_trigger = {
		looking_for_a = holy_site
		source = recipient
		target_flag = target
		name = "pilgrimage_select_holy_site_title"
		none_available_msg_key = "pilgrimage_yanantin_no_holy_sites"
		column = {
			data = name
		}
		visible = {
			location = {
				has_owner = yes
				OR = {
					owner = scope:actor
					owner = {
						OR = {
							is_allied_with = { target = scope:actor }
							"opinion(scope:actor)" > 50
						}
					}
				}
			}
		}
	}

	effect = {
		scope:actor = {
			if = {
				limit = {exists = scope:target}
				switch = {
					trigger = scope:target.god
					#If male god
					god:viracocha = { add_yanantin = -20 }
					god:inti_god = { add_yanantin = -20 }
					god:illapa_god = { add_yanantin = -20 }
					#If female god
					god:mamaquilla = { add_yanantin = 20 }
					god:pachamama = { add_yanantin = 20 }
					god:mama_cocha = { add_yanantin = 20 }
					god:urpihuachac_god = { add_yanantin = 20 }
				}
			}
		}
	}

	ai_will_do = {
		#If male god
		if = {
			limit = {scope:target.god = god:viracocha}
			add = "scope:actor.currency_utility(yanantin|-20)"
		}
		else_if = {
			limit = {scope:target.god = god:inti_god}
			add = "scope:actor.currency_utility(yanantin|-20)"
		}
		else_if = {
			limit = {scope:target.god = god:illapa_god}
			add = "scope:actor.currency_utility(yanantin|-20)"
		}
		#If female god
		else_if = {
			limit = {scope:target.god = god:mamaquilla}
			add = "scope:actor.currency_utility(yanantin|20)"
		}
		else_if = {
			limit = {scope:target.god = god:pachamama}
			add = "scope:actor.currency_utility(yanantin|20)"
		}
		else_if = {
			limit = {scope:target.god = god:mama_cocha}
			add = "scope:actor.currency_utility(yanantin|20)"
		}
		else_if = {
			limit = {scope:target.god = god:urpihuachac_god}
			add = "scope:actor.currency_utility(yanantin|20)"
		}
	}
}


inti_ceremonial_festivals = {
	type = religious

	sound = UI_action_religion_generic
	
	potential = {
		scope:actor.religion = religion:inti
	}

	allow = {
		scope:actor.gold >= {
			value = scope:actor.monthly_income_trade_and_tax
			multiply = 4
		}
	}

	ai_tick = monthly
	ai_tick_frequency = 6

	automation_tick = monthly
	automation_tick_frequency = 1
	player_automated_category = religiousdoctrines
	
	price = price:inti_ceremonial_festivals

	cooldown = {
		type = inti_ceremonial_festivals
		years = 1
	}
	
	select_trigger = {
		looking_for_a = religion
		source = actor
		target_flag = recipient
		name = "choose_religion"
		column = { data = name }
	}

	effect = {
		scope:actor = {
			if = {
				limit = {
					time_of_year = { min = 1.1 max = 2.1 }
				}
				custom_tooltip = { text = zamay_quilla_tt }
				add_country_modifier = { modifier = zamay_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 2.1 max = 3.1 }
				}
				custom_tooltip = { text = hatun_pucuy_quilla_tt }
				add_country_modifier = { modifier = hatun_pucuy_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 3.1 max = 4.1 }
				}
				custom_tooltip = { text = pacha_pucuy_quilla_tt }
				add_country_modifier = { modifier = pacha_pucuy_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 4.1 max = 5.1 }
				}
				custom_tooltip = { text = ayrihua_quilla_tt }
				add_country_modifier = { modifier = ayrihua_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 5.1 max = 6.1 }
				}
				custom_tooltip = { text = aymoray_quilla_tt }
				add_country_modifier = { modifier = aymoray_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 6.1 max = 7.1 }
				}
				custom_tooltip = { text = haucai_cusqui_quilla_tt }
				add_country_modifier = { modifier = haucai_cusqui_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 7.1 max = 8.1 }
				}
				custom_tooltip = { text = chacra_conaqui_quilla_tt }
				add_country_modifier = { modifier = chacra_conaqui_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 8.1 max = 9.1 }
				}
				custom_tooltip = { text = chacra_yapuy_quilla_tt }
				add_country_modifier = { modifier = chacra_yapuy_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 9.1 max = 10.1 }
				}
				custom_tooltip = { text = coia_raymi_quilla_tt }
				add_country_modifier = { modifier = coia_raymi_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 10.1 max = 11.1 }
				}
				custom_tooltip = { text = uma_raymi_quilla_tt }
				add_country_modifier = { modifier = uma_raymi_quilla_modifier years = 1 mode = add }
			}
			else_if = {
				limit = {
					time_of_year = { min = 11.1 max = 12.1 }
				}
				custom_tooltip = { text = ayamarca_raymi_quilla_tt }
				add_country_modifier = { modifier = ayamarca_raymi_quilla_modifier years = 1 mode = add }
			}
			else = {
				custom_tooltip = { text = capac_raymi_quilla_tt }
				add_country_modifier = { modifier = capac_raymi_quilla_modifier years = 1 mode = add }
			}
		}
	}

	ai_will_do = {
		if = {
			limit = {
				time_of_year = { min = 1.1 max = 2.1 }
			}
			add = "scope:actor.add_static_modifier_utility(zamay_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 2.1 max = 3.1 }
			}
			add = "scope:actor.add_static_modifier_utility(hatun_pucuy_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 3.1 max = 4.1 }
			}
			add = "scope:actor.add_static_modifier_utility(pacha_pucuy_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 4.1 max = 5.1 }
			}
			add = "scope:actor.add_static_modifier_utility(ayrihua_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 5.1 max = 6.1 }
			}
			add = "scope:actor.add_static_modifier_utility(aymoray_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 6.1 max = 7.1 }
			}
			add = "scope:actor.add_static_modifier_utility(haucai_cusqui_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 7.1 max = 8.1 }
			}
			add = "scope:actor.add_static_modifier_utility(chacra_conaqui_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 8.1 max = 9.1 }
			}
			add = "scope:actor.add_static_modifier_utility(chacra_yapuy_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 9.1 max = 10.1 }
			}
			add = "scope:actor.add_static_modifier_utility(coia_raymi_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 10.1 max = 11.1 }
			}
			add = "scope:actor.add_static_modifier_utility(uma_raymi_quilla_modifier)"
		}
		else_if = {
			limit = {
				time_of_year = { min = 11.1 max = 12.1 }
			}
			add = "scope:actor.add_static_modifier_utility(ayamarca_raymi_quilla_modifier)"
		}
		else = {
			add = "scope:actor.add_static_modifier_utility(capac_raymi_quilla_modifier)"
		}
	}
}
