#Delhi

fall_of_delhi_plea_neighbors = {
	type = situation
	
	ai_tick = daily
	ai_tick_frequency = 40

	automation_tick = never
	automation_tick_frequency = 12

	potential = {
		scope:actor = {
			tag = DLH
		}
	}

	allow = {
		scope:actor = {
			gold >= {
				value = scope:actor.monthly_income_trade_and_tax
				multiply = 2
			}
		}
		scope:actor = { NOT = { has_country_modifier = delhi_embassies_modifier } }
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:fall_of_delhi = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			add_gold = {
				value = monthly_income_trade_and_tax
				multiply = -2
			}
			add_country_modifier = {
				modifier = delhi_embassies_modifier
				years = 5
				mode = replace
			}
		}
		custom_tooltip = gain_3_sop_tt
		hidden_effect = {
			c:DLH = {
				change_variable = {
					name = fall_of_delhi_vote_weight
					add = 0.03
				}
			}
		}
	}

	ai_will_do = {	#AI will do this more likely if the number of opposers is too high
		add = -50
		add = {
			if = {
				limit = {
					any_country = {
						has_variable = delhi_claimants_variable
						count > 25
					}
				}
				value = 100
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						gold >= {
							value = monthly_income_trade_and_tax
							multiply = 8
						}
					}
				}
				value = 100
			}
		}
	}
}

fall_of_delhi_appoint_governors = {
	type = situation

	ai_tick = daily
	ai_tick_frequency = 40

	automation_tick = never
	automation_tick_frequency = 12
	
	potential = {
		scope:actor = {
			tag = DLH
		}
	}

	allow = {
		scope:actor = {
			gold >= {
				value = scope:actor.monthly_income_trade_and_tax
				multiply = 2
			}
		}
		scope:actor = { NOT = { has_country_modifier = delhi_loyal_governors_modifier } }
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:fall_of_delhi = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			add_gold = {
				value = monthly_income_trade_and_tax
				multiply = -2
			}
			add_country_modifier = {
				modifier = delhi_loyal_governors_modifier
				years = 5
				mode = replace
			}
		}
		custom_tooltip = dlh_reduce_frequency_of_revolt_events_tt
		custom_tooltip = gain_3_sop_tt
		hidden_effect = {
			c:DLH = {
				change_variable = {
					name = fall_of_delhi_vote_weight
					add = 0.03
				}
			}
		}
	}

	ai_will_do = {	#AI will do this more likely if it has powerful revolts brewing
		add = -50
		add = {
			if = {
				limit = {
					scope:actor = {
						any_rebel = { 
							rebel_progress >= 0.1 
							count >= 4
						}
					}
				}
				value = 200
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						gold >= {
							value = monthly_income_trade_and_tax
							multiply = 8
						}
					}
				}
				value = 100
			}
		}
	}
}

fall_of_delhi_reaffirm_vassal_relations = {
	type = situation

	ai_tick = daily
	ai_tick_frequency = 40

	automation_tick = never
	automation_tick_frequency = 12
	
	potential = {
		scope:actor = {
			tag = DLH
		}
	}

	allow = {
		scope:actor = {
			gold >= {
				value = scope:actor.monthly_income_trade_and_tax
				multiply = 2
			}
		}
		scope:actor = { NOT = { has_country_modifier = delhi_reaffirm_vassal_relations_modifier } }
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:fall_of_delhi = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			add_gold = {
				value = monthly_income_trade_and_tax
				multiply = -2
			}
			add_country_modifier = {
				modifier = delhi_reaffirm_vassal_relations_modifier
				years = 5
				mode = replace
			}
		}
		custom_tooltip = gain_3_sop_tt
		hidden_effect = {
			c:DLH = {
				change_variable = {
					name = fall_of_delhi_vote_weight
					add = 0.03
				}
			}
		}
	}

	ai_will_do = {	#AI will do this more likely if it has powerful VASSALS that are disloyal
		add = {
			if = {
				limit = {
					scope:actor = {
						any_subject = { 
							relative_strength = {
								target = scope:actor
								value >= 0.25
							}
						}
					}
				}
				value = 100
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						gold >= {
							value = monthly_income_trade_and_tax
							multiply = 6
						}
					}
				}
				value = 100
			}
		}
	}
}

fall_of_delhi_appease_the_nobility = {
	type = situation

	ai_tick = daily
	ai_tick_frequency = 40

	automation_tick = never
	automation_tick_frequency = 12
	
	potential = {
		scope:actor = {
			tag = DLH
		}
	}

	allow = {
		scope:actor = {
			gold >= {
				value = scope:actor.monthly_income_trade_and_tax
				multiply = 2
			}
			government_power > 10
		}
		scope:actor = { NOT = { has_country_modifier = delhi_appeased_the_nobles_modifier } }
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:fall_of_delhi = this
			situation_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_left }
			add_gold = {
				value = monthly_income_trade_and_tax
				multiply = -2
			}
			add_gold_to_estate = {
				estate_type = estate_type:nobles_estate
				value = {
					value = monthly_income_trade_and_tax
					multiply = 2
				}
			}
			add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
			add_country_modifier = {
				modifier = delhi_appeased_the_nobles_modifier
				years = 5
				mode = replace
			}
			custom_tooltip = appease_nobility_effect_tt
		}
		custom_tooltip = gain_3_sop_tt
		hidden_effect = {
			c:DLH = {
				change_variable = {
					name = fall_of_delhi_vote_weight
					add = 0.03
				}
			}
		}
	}

	ai_will_do = {	#AI will do this more likely if it has powerful VASSALS that are disloyal
		add = {
			if = {
				limit = {
					scope:actor = {
						estate_satisfaction:nobles_estate < 0.5
					}
				}
				value = 50
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						government_power >= 80
					}
				}
				value = 100
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						gold >= {
							value = monthly_income_trade_and_tax
							multiply = 12
						}
					}
				}
				value = 50
			}
		}
	}
}

strengthen_neighbor_relations = {
	type = situation

	ai_tick = daily
	ai_tick_frequency = 40

	automation_tick = never
	automation_tick_frequency = 12

	cooldown = {
		type = strengthen_neighbor_relations
		years = 1
	}
	
	potential = {
		scope:actor = {
			tag = DLH
		}
	}

	allow = {
		scope:actor = { num_of_diplomats > diplomats_mild_bonus }
	}

	select_trigger = {
		looking_for_a = situation
		target_flag = recipient
		name = "choose_situation"
		column = {
			data = name
		}
		visible = {
			situation:fall_of_delhi = this
			situation_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = area
		target_flag = target
		name = "select_area"
		none_available_msg_key = "no_valid_areas"
		column = {
			data = name
		}
		visible = {
			any_country_with_capital_in_geography = {
				can_see_situation = situation:fall_of_delhi 
				this != c:DLH
				NOT = {
					has_opinion = {
						target = c:DLH 
						modifier = opinion_fall_of_delhi_delegates 
					}
				}
			}
		}
	}

	effect = {
		scope:actor = { add_diplomats = diplomats_mild_penalty }
		scope:target = {
			every_country_with_capital_in_geography = {
				limit = {
					can_see_situation = situation:fall_of_delhi 
					this != c:DLH
				}
				add_opinion = {
					target = c:DLH
					modifier = opinion_fall_of_delhi_delegates
				}
			}
		}
	}

	ai_will_do = {	#AI will do this always
		add = 25
		add = {
			value = scope:actor.num_of_diplomats
			multiply = 10
		}
		if = {
			limit = {
				exists = scope:target
			}
			if = {
				limit = {
					scope:target = {
						any_country_with_capital_in_geography = {
							this != scope:actor
							relative_strength = {
								target = scope:actor
								value > 0.25
							}
						}
					}
				}
				add = 25
			}
			if = {
				limit = {
					scope:target = {
						any_country_with_capital_in_geography = {
							this != scope:actor
							is_threat_to = scope:actor
						}
					}
				}
				add = 50
			}
			scope:target = {
				every_country_with_capital_in_geography = {
					limit = { 
						this != scope:actor
						can_declare_war_on = scope:actor
					}
					add = {
						value = "threat_level_to(scope:actor)"
						multiply = 100
					}
				}
			}
		}
	}
}
