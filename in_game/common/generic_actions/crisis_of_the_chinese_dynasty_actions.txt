cmd_negotiate_with_rebels = {
	type = disaster
	
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor = {
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
	}
	price = price:rtr_negotiate_with_rebels_price
	
	select_trigger = {
		looking_for_a = disaster
		name = "choose_disaster"
		target_flag = recipient
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:crisis_of_the_chinese_dynasty
			disaster_is_active = yes
		}
	}

	select_trigger = {
		looking_for_a = rebels
		source = actor
		target_flag = target_rebel
		name = "rtr_negotiate_with_rebels_select_rebels"
		none_available_msg_key = "rtr_negotiate_with_rebels_no_rebels"
		column = { data = name }
		column = { data = rebel_progress }
		column = { data = monthly_progress }
		visible = { rebel_progress > 0.3 }
	}

	effect = {
		if = {
			limit = { exists = scope:target_rebel }
			scope:actor = {
				trigger_event_non_silently = crisis_of_the_chinese_dynasty.6
			}
		}
		custom_tooltip = cmd_negotiate_with_rebels_tt
		custom_tooltip = cmd_negotiate_nationalist
		custom_tooltip = cmd_negotiate_estate
		custom_tooltip = cmd_negotiate_religious
	}

	ai_will_do = {	#AI will do this more likely if it has powerful revolts brewing
		add = -50
		add = {
			if = {
				limit = {
					scope:actor = {
						any_rebel = { 
							rebel_progress >= 0.5
							count >= 4
						}
					}
				}
				value = 200
			}
		}
		add = {
			if = {
				limit = {
					scope:actor = {
						gold >= {
							value = monthly_income_trade_and_tax
							multiply = {
								value = 1.5
								multiply = num_rebels
							}
						}
					}
				}
				value = 100
			}
		}
	}
}

cmd_reform_the_cabinet = {
	type = disaster

	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12
	
	potential = {
		scope:actor = {
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
	}
	price = price:rtr_negotiate_with_rebels_price
	allow = {
		scope:actor = {
			OR = {
				AND = {
					trigger_if = {
						limit = { country_has_estate = estate_type:nobles_estate }
						estate_satisfaction:nobles_estate > 0.6
					}
					trigger_if = {
						limit = { country_has_estate = estate_type:clergy_estate }
						estate_satisfaction:clergy_estate > 0.6
					}
					trigger_if = {
						limit = { country_has_estate = estate_type:burghers_estate }
						estate_satisfaction:burghers_estate > 0.6
					}
					trigger_if = {
						limit = { country_has_estate = estate_type:peasants_estate }
						estate_satisfaction:peasants_estate > 0.6
					}
				}
				"estate_power(estate_type:crown_estate)" > 0.5
				any_cabinet_character = {
					total_abilities > 250
					count > 2
				}
			}
			custom_tooltip = {
				text = has_not_already_enacted_this_action_during_the_disaster_tt
				NOT = { has_variable = reformed_the_cabinet_variable }
			}
		}
	}
	
	select_trigger = {
		looking_for_a = disaster
		name = "choose_disaster"
		target_flag = recipient
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:crisis_of_the_chinese_dynasty
			disaster_is_active = yes
		}
	}

	effect = {
		change_celestial_authority = { value = celestial_authority_weak_bonus }
		scope:actor = {
			if = {
				limit = { "estate_power(estate_type:crown_estate)" > 0.5 }
				add_government_power = government_power_mild_bonus
			}
			hidden_effect = { set_variable = reformed_the_cabinet_variable }
		}
	}

	ai_will_do = {
		add = 100
	}
}

cmd_revise_the_tax_code = {
	type = disaster
	
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor = {
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
	}

	allow = {
		custom_tooltip = {
			text = has_completed_revised_tax_code_tt
			scope:actor = { has_variable = revised_tax_code_variable }
		}
		custom_tooltip = {
			text = has_not_already_enacted_this_action_during_the_disaster_tt
			scope:actor = {
				NOT = { has_variable = completed_tax_revision_variable }
			}
		}
	}

	select_trigger = {
		looking_for_a = disaster
		name = "choose_disaster"
		target_flag = recipient
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:crisis_of_the_chinese_dynasty
			disaster_is_active = yes
		}
	}

	effect = {
		change_celestial_authority = { value = celestial_authority_weak_bonus }
		scope:actor = {
			add_inflation = inflation_extreme_bonus
			hidden_effect = {
				if = {
					limit = { has_variable = revised_tax_code_variable }
					remove_variable = revised_tax_code_variable
				}
				set_variable = completed_tax_revision_variable 
			}
		}
	}

	ai_will_do = {
		add = 1000
	}
}

cmd_restore_stability = {
	type = disaster
	
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor = {
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
	}

	price = price:rtr_negotiate_with_rebels_price

	allow = {
		scope:actor = {
			stability >= 50
			custom_tooltip = {
				text = has_not_already_enacted_this_action_during_the_disaster_tt
				NOT = { has_variable = cmd_restored_stability_variable }
			}
		}
	}

    select_trigger = {
		looking_for_a = disaster
		name = "choose_disaster"
		target_flag = recipient
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:crisis_of_the_chinese_dynasty
			disaster_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			hidden_effect = { set_variable = cmd_restored_stability_variable }
			trigger_event_non_silently = crisis_of_the_chinese_dynasty.8
		}
	}

	ai_will_do = {
		add = 1000
	}
}

cmd_strengthen_crown = {
	type = disaster
	
	ai_tick = daily
	ai_tick_frequency = 80

	automation_tick = never
	automation_tick_frequency = 12

	
	potential = {
		scope:actor = {
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
	}

	allow = {
		scope:actor = {
			government_power >= 90
			custom_tooltip = {
				text = has_not_already_enacted_this_action_during_the_disaster_tt
				NOT = { has_variable = cmd_strengthened_crown_variable }
			}
		}
	}

	price = price:rtr_negotiate_with_rebels_price

	select_trigger = {
		looking_for_a = disaster
		name = "choose_disaster"
		target_flag = recipient
		column = {
			data = name
		}
		visible = {
			disaster_type = disaster_type:crisis_of_the_chinese_dynasty
			disaster_is_active = yes
		}
	}

	effect = {
		scope:actor = {
			hidden_effect = { set_variable = cmd_strengthened_crown_variable }
			trigger_event_non_silently = crisis_of_the_chinese_dynasty.9
		}
	}

	ai_will_do = {
		add = 1000
	}
}