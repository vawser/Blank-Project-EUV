#Foundation Law
union_foundation_law = {
	type = international_organization
	law_category = foundation
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 5
		# NOT = { has_cooldown = union_recent_policy_change_cd }
	}
	locked = {
		international_organization_has_law = law:union_foundation_law
		international_organization_has_policy = policy:union_senior_succession_law
	}
	custom_tags = { forbids_no_policy }
	union_establish_seniority_policy = {
		allow = {
			is_same_ruler_personal_union = yes
		}
		has_parliament = yes
		propose_effect = {
			scope:recipient ?= {
				ordered_international_organization_member = {
					order_by = great_power_score
					max = 1
					check_range_bounds = no
					save_scope_as = best_senior_partner_candidate
				}
				if = {
					limit = { exists = scope:best_senior_partner_candidate }
					set_variable = {
						name = pre_selected_senior_partner
						value = scope:best_senior_partner_candidate
					}
				}
			}
		}
		on_activate = {
			custom_tooltip = union_senior_partner_policy_at
			on_union_policy_change_effect = yes
			if = {
				limit = { NOT = { has_variable = pre_selected_senior_partner } }
				custom_tooltip = union_senior_partner_policy_tt
			}
			else = {
				custom_tooltip = union_senior_partner_policy_specific_tt
			}
			set_parliament_type = parliament_type:union_royal_assembly
			custom_tooltip = union_unlocks_independence_casus_belli_tt
			custom_tooltip = union_unlocks_war_for_seniority_casus_belli_tt
		}
		wants_propose_policy = {
			if = {
				limit = {
					is_most_likely_candidate_for_seniority = { union = scope:recipient }
					scope:recipient = {
						any_international_organization_member = {
							this != root
							is_neighbor_of = root
						}
					}
				}
				add = {
					desc = "POLICY_WOULD_BECOME_LEADER_OF_ORGANIZATION"
					value = 1000
				}
			}
			else = {
				add = {
					desc = "VOTE_BASE_VALUE"
					value = -50
				}
			}
		}
		wants_this_policy_bias = {
			add = {
				desc = "VOTE_BASE_VALUE"
				value = -50
			}
			if = {
				limit = { is_most_likely_candidate_for_seniority = { union = scope:recipient } }
				add = {
					desc = "POLICY_WOULD_BECOME_LEADER_OF_ORGANIZATION"
					value = 1000
				}
			}
			else_if = {
				limit = {
					get_most_likely_candidate_for_seniority = { union = scope:recipient }
					exists = scope:likely_senior_partner
				}
				add = {
					desc = "POLICY_DIP_REP_OF_FUTURE_LEADER"
					value = scope:likely_senior_partner.modifier:diplomatic_reputation
					multiply = 3
				}
				add = {
					desc = "POLICY_OPINION_OF_FUTURE_LEADER"
					value = "root.opinion(scope:likely_senior_partner)"
				}
				if = {
					limit = { scope:recipient.total_members > 1 }
					add = {
						desc = "POLICY_POWER_COMPARISON_OF_FUTURE_LEADER"
						value = {
							value = 0
							scope:recipient = {
								every_international_organization_member = {
									limit = { NOT = { this = scope:likely_senior_partner } }
									add = great_power_score
								}
							}
							divide = {
								value = scope:recipient.total_members
								subtract = 1
							}
							subtract = scope:likely_senior_partner.great_power_score
							multiply = -1
						}
					}
				}
			}
		}
	}
	union_maintain_federal_status_policy = {
		country_modifier = {
			stability_investment = tiny_stability_investment
		}
		on_activate = {
			on_union_policy_change_effect = yes
		}
		wants_this_policy_bias = {
			#AI is always in favor of not being anyone's puppet
			add = {
				desc = "POLICY_GUARANTEED_FREEDOM"
				value = 50
			}
			if = {
				limit = { is_most_likely_candidate_for_seniority = { union = scope:recipient } }
				add = {
					desc = "POLICY_WOULD_BECOME_LEADER_OF_ORGANIZATION"
					value = -1000
				}
			}
			else_if = {
				limit = {
					get_most_likely_candidate_for_seniority = { union = scope:recipient }
					exists = scope:likely_senior_partner
				}
				add = {
					desc = "POLICY_DIP_REP_OF_FUTURE_LEADER"
					value = scope:likely_senior_partner.modifier:diplomatic_reputation
					multiply = -3
				}
				add = {
					desc = "POLICY_OPINION_OF_FUTURE_LEADER"
					value = "root.opinion(scope:likely_senior_partner)"
					multiply = -1
				}
				if = {
					limit = { scope:recipient.total_members > 1 }
					add = {
						desc = "POLICY_POWER_COMPARISON_OF_FUTURE_LEADER"
						value = {
							value = 0
							scope:recipient = {
								every_international_organization_member = {
									limit = { NOT = { this = scope:likely_senior_partner } }
									add = great_power_score
								}
							}
							divide = {
								value = scope:recipient.total_members
								subtract = 1
							}
							subtract = scope:likely_senior_partner.great_power_score
						}
					}
				}
			}
		}
	}
}

#Inheritance Law
union_codified_inheritance_law = {
	type = international_organization
	law_category = centralization
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 10
		# NOT = { has_cooldown = union_recent_policy_change_cd }
		international_organization_has_law = law:union_foundation_law
	}
	locked = {
		international_organization_has_policy = policy:union_unified_treasury_policy
	}
	custom_tags = { forbids_no_policy }

	union_senior_succession_law = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_establish_seniority_policy
		}
		on_activate = {
			on_union_policy_change_effect = yes
			apply_same_inheritance_policy_effect = yes
			change_union_integration_level = { value = 1 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -1 }
		}
		international_organization_modifier = {
			union_integration_level = 1
			enabled_negotiate_succession_law = yes
		}
		country_modifier = {
			potential_trigger = {
				NOT = {
					has_special_status_in_international_organization = {
						type = special_status:senior_partner
						international_organization = union
					}
				}
			}
			blocked_from_changing_heir_selection = yes
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
		}
	}

	union_sovereign_succession_law = {
		on_activate = {
			on_union_policy_change_effect = yes
		}
		country_modifier = {
			monthly_legitimacy = 0.05
		}
		international_organization_modifier = {
		}
		wants_this_policy_bias = {
			#AI is always in favor of not being anyone's puppet. We don't need some high math here as this is the default when the centralization option is rejected
			add = {
				desc = "POLICY_RESPECTS_SOVEREIGNTY"
				value = 10
			}
			if = {
				limit = { is_most_likely_candidate_for_seniority = { union = scope:recipient } }
				multiply = {
					desc = "POLICY_LOSING_OPPORTUNITY_TO_CENTRALIZE"
					value = -1
				}
			}
		}
	}
}

#Economic Law
union_economic_law = {
	type = international_organization
	law_category = centralization
	custom_tags = { forbids_no_policy }
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 20
		# NOT = { has_cooldown = union_recent_policy_change_cd }
		international_organization_has_law = law:union_codified_inheritance_law
	}
	locked = {
		international_organization_has_law = law:union_economic_law
		international_organization_has_policy = policy:union_unified_external_diplomacy_policy
	}

	union_unified_treasury_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_senior_succession_law
		}
		payments_implemented = { union_contribution }
		on_activate = {
			on_union_policy_change_effect = yes
			change_union_integration_level = { value = 1 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -1 }
		}
		international_organization_modifier = {
			union_integration_level = 1
		}	
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
		}
	}

	union_cooperative_investment_policy = {
		on_activate = {
			on_union_policy_change_effect = yes
		}
		can_build_buildings_in_members = yes
		can_build_roads_in_members = yes
		can_build_rgos_in_members = yes
		wants_this_policy_bias = {
			add = union_member_opinion_on_maintain
		}
	}
}

#Diplomatic Law
union_diplomatic_law = {
	type = international_organization
	law_category = centralization
	custom_tags = { forbids_no_policy }
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 30
		# NOT = { has_cooldown = union_recent_policy_change_cd }
		international_organization_has_law = law:union_economic_law
	}
	locked = {
		international_organization_has_law = law:union_diplomatic_law
		international_organization_has_policy = policy:union_aligned_legislature_policy
	}

	union_unified_external_diplomacy_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_unified_treasury_policy
		}
		on_activate = {
			on_union_policy_change_effect = yes
			change_union_integration_level = { value = 1 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -1 }
		}
		international_organization_modifier = {
			union_integration_level = 1
		}
		has_limited_diplomacy = {
			NOT = {
				has_special_status_in_international_organization = {
					type = special_status:senior_partner
					international_organization = scope:recipient
				}
			}
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
		}
	}
	union_organized_diplomats_policy = {
		on_activate = {
			on_union_policy_change_effect = yes
		}
		country_modifier = {
			diplomatic_capacity_modifier = 0.1
			monthly_diplomats = 0.1
			max_diplomats = 1
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_maintain
		}
	}
}

#Legislative Law
union_legislature_law = {
	type = international_organization
	law_category = centralization
	custom_tags = { forbids_no_policy }
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 40
		# NOT = { has_cooldown = union_recent_policy_change_cd }
		international_organization_has_law = law:union_diplomatic_law
	}
	locked = {
		international_organization_has_law = law:union_legislature_law
		international_organization_has_law = law:union_unification_of_crowns_law
		NOT = { international_organization_has_policy = policy:union_federal_union_policy }
	}

	union_aligned_legislature_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_unified_external_diplomacy_policy
		}
		on_activate = {
			on_union_policy_change_effect = yes
			apply_same_laws_policy_effect = yes
			change_union_integration_level = { value = 1 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -1 }
		}
		international_organization_modifier = {
			union_integration_level = 1
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
		}
	}
	union_federal_legislature_policy = {
		on_activate = {
			on_union_policy_change_effect = yes
		}
		country_modifier = {
			country_cabinet_efficiency = 0.1
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_maintain
		}
	}
}

#Unification Law
# Note: update define_values.txt and 11_union_issue.txt when adding more centralization laws
union_unification_of_crowns_law = {
	type = international_organization
	law_category = centralization
	custom_tags = { forbids_no_policy }
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 50
		# NOT = { has_cooldown = union_recent_policy_change_cd }
		international_organization_has_law = law:union_legislature_law
	}
	locked = {
	}

	union_rapid_crown_unification_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_aligned_legislature_policy
			OR = {
				international_organization_has_policy = policy:union_rapid_crown_unification_policy
				international_organization_has_policy = policy:union_swift_crown_unification_policy
			}
		}
		on_activate = {
			on_union_policy_change_effect = yes
			change_union_integration_level = { value = 3 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -3 }
		}
		allow_member_annexation = yes
		international_organization_modifier = {
			union_integration_level = 3
		}
		annexation_speed = 2
		international_organization_modifier = {
			years_to_annex_members = -20
			enable_annexation_of_members = yes
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
			subtract = 100
		}
	}
	union_swift_crown_unification_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_aligned_legislature_policy
			OR = {
				international_organization_has_policy = policy:union_rapid_crown_unification_policy
				international_organization_has_policy = policy:union_swift_crown_unification_policy
				international_organization_has_policy = policy:union_crown_unification_policy
			}
		}
		on_activate = {
			on_union_policy_change_effect = yes
			change_union_integration_level = { value = 2 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -2 }
		}
		allow_member_annexation = yes
		international_organization_modifier = {
			union_integration_level = 2
		}
		annexation_speed = 1.5
		international_organization_modifier = {
			enable_annexation_of_members = yes
			years_to_annex_members = -10
		}
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
			subtract = 50
		}
	}
	union_crown_unification_policy = {
		allow = {
			is_same_ruler_personal_union = yes
			has_active_senior_partner = yes
			international_organization_has_policy = policy:union_aligned_legislature_policy
		}
		on_activate = {
			on_union_policy_change_effect = yes
			change_union_integration_level = { value = 1 }
		}
		on_deactivate = {
			change_union_integration_level = { value = -1 }
		}
		allow_member_annexation = yes
		international_organization_modifier = {
			enable_annexation_of_members = yes
			union_integration_level = 1
		}
		annexation_speed = 1
		wants_this_policy_bias = {
			add = union_member_opinion_on_centralization
			subtract = 25
		}
	}

	union_federal_union_policy = {
		on_activate = {
			on_union_policy_change_effect = yes
		}
		opinion_bonus = 25
		trust_bonus = 5
		wants_this_policy_bias = {
			add = union_member_opinion_on_maintain
		}
	}
}

#Military Law
union_mutual_offense_law = {
	type = international_organization
	law_category = federal
	potential = { 
		international_organization_type = international_organization_type:union
	}
	allow = {
		international_organization_lifetime >= 25
		# NOT = { has_cooldown = union_recent_policy_change_cd }
	}
	locked = {
	}

	union_assured_offense_policy = {
		allow = { policy_is_voting_target = { policy = policy:union_assured_offense_policy } }
		on_activate = {
			on_union_policy_change_effect = yes
		}
		join_offensive_wars_always = {
			always = yes
		}
		wants_this_policy_bias = {
			add = {
				desc = "VOTE_BASE_VALUE"
				value = -100
			}
			add = io_wants_offensive_war_policy
		}
	}

	union_automatic_offense_policy = {
		allow = { policy_is_voting_target = { policy = policy:union_automatic_offense_policy } }
		on_activate = {
			on_union_policy_change_effect = yes
		}
		join_offensive_wars_auto_call = {
			always = yes
		}
		wants_this_policy_bias = {
			add = {
				desc = "VOTE_BASE_VALUE"
				value = -50
			}
			add = io_wants_offensive_war_policy
		}
	}

	union_possible_offense_policy = {
		allow = { policy_is_voting_target = { policy = policy:union_possible_offense_policy } }
		on_activate = {
			on_union_policy_change_effect = yes
		}
		join_offensive_wars_can_call = {
			always = yes
		}
		wants_this_policy_bias = {
			add = {
				desc = "VOTE_BASE_VALUE"
				value = -25
			}
			add = io_wants_offensive_war_policy
		}
	}
}